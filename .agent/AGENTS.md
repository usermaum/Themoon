# AI Agents Common Manifesto (AGENTS.md)

> **Master Rules for All AI Agents**
> This file is the **Single Source of Truth** for strict project rules.
> Whether you are **Claude** or **Gemini**, you MUST follow these instructions.

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ì›ì¹™ (Clean Architecture Standard)

> **2025-12-23 ë„ì…**: ì ì§„ì  ì ìš©ì„ ìœ„í•œ í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ
> **ì ìš© ëŒ€ìƒ**: `Bean` ëª¨ë“ˆ(Refactoring) ë° **ëª¨ë“  ì‹ ê·œ ê¸°ëŠ¥**(Phase 2+)

### 1. Repository Pattern í•„ìˆ˜ (Repository Pattern)

* **ì›ì¹™**: `Service` Layerì—ì„œ `db.query()`, `db.add()`, `db.commit()` ë“±ì„ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **êµ¬í˜„**: ëª¨ë“  DB ì ‘ê·¼ì€ `app/repositories/*` íŒ¨í‚¤ì§€ ë‚´ì˜ Repository í´ë˜ìŠ¤ë¥¼ í†µí•´ì„œë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* **ì´ìœ **: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ (SQLAlchemy)ì˜ ë¶„ë¦¬, í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í™•ë³´, ì¥ê¸°ì  ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ.

### 2. ì˜ì¡´ì„± ê·œì¹™ (Dependency Rule)

* âœ… `Controller (Router)` â†’ `Service` â†’ `Repository` â†’ `Model`
* âŒ `Service`ê°€ `Controller(HTTP Request ë“±)` ì˜ì¡´ ê¸ˆì§€.
* âŒ `Repository`ê°€ `UI/Web` ê´€ë ¨ ë¡œì§ ì˜ì¡´ ê¸ˆì§€.

### 3. ì„œë¹„ìŠ¤ ìˆœìˆ˜ì„± (Service Purity)

* Service ë©”ì„œë“œëŠ” ì˜¤ì§ **Pydantic Schema**ë‚˜ **Primitive Type** ë§Œì„ ì¸ìë¡œ ë°›ê³  ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
* `FastAPI.Request`, `FastAPI.Depends` ë“±ì˜ ì›¹ í”„ë ˆì„ì›Œí¬ ê°ì²´ë¥¼ Service ë‚´ë¶€ë¡œ ì¹¨íˆ¬ì‹œí‚¤ì§€ ë§ˆì‹­ì‹œì˜¤.

---

## ğŸ—£ï¸ ì–¸ì–´ ê·œì¹™ (MANDATORY)

**ì¤‘ìš”**: ì‚¬ìš©ìëŠ” ì˜ì–´ ì´ˆë³´ìì…ë‹ˆë‹¤. ëª¨ë“  ëŒ€í™”, **ê²°ê³¼ ì„¤ëª…, ì²´í¬ ìƒí™©, ì§„í–‰ ìƒíƒœ** ë“± ì‚¬ìš©ìê°€ ì½ì–´ì•¼ í•˜ëŠ” ëª¨ë“  í…ìŠ¤íŠ¸ëŠ” **ë°˜ë“œì‹œ í•œê¸€**ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

* ì½”ë“œ, ë¡œê·¸, ì—ëŸ¬ ë©”ì‹œì§€ ì›ë³¸ì€ ì˜ì–´ë¡œ ìœ ì§€í•˜ë˜, **ë°˜ë“œì‹œ í•œê¸€ ì„¤ëª…**ì„ ë§ë¶™ì—¬ì•¼ í•©ë‹ˆë‹¤.
* "Checking..." ê°™ì€ ì§„í–‰ ìƒí™©ë„ "í™•ì¸ ì¤‘..."ê³¼ ê°™ì´ í•œê¸€ë¡œ í‘œí˜„í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ› ï¸ í•µì‹¬ ë„êµ¬ ë° ê¸°ìˆ  ìŠ¤íƒ (MANDATORY)

ì‘ì—… ì‹œ ë‹¤ìŒ ë„êµ¬ì™€ ê¸°ìˆ ì„ **ë¬´ì¡°ê±´** ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤:

1. **AI ë„êµ¬ & MCP**:

   * **Context7**: ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¸ì„œ ë° ì»¨í…ìŠ¤íŠ¸ ê²€ìƒ‰  ìƒí™©ì—ë”°ë¼ íŒë‹¨í•˜ì—¬ ì‚¬ìš© í•„ìˆ˜ ì•„ë‹˜.
2. **Frontend Tech Stack**:

   * **Framework**: Next.js (App Router)
   * **UI Library**: **Shadcn UI** (v2, CSS Modules)
3. **Documentation Tools**:

   * **Mermaid**: ëª¨ë“  ì•„í‚¤í…ì²˜, í”Œë¡œìš°, ERD ë‹¤ì´ì–´ê·¸ë¨ì€ **ë°˜ë“œì‹œ Mermaid ë¬¸ë²•**ìœ¼ë¡œ ì‘ì„±í•©ë‹ˆë‹¤. (ì´ë¯¸ì§€ ì—…ë¡œë“œ ì§€ì–‘)
     * **v8.8.0 í˜¸í™˜ì„± í•„ìˆ˜**: `subgraph ID [Label]` ë¬¸ë²• ì‚¬ìš© ê¸ˆì§€ â†’ `subgraph "Label"` ë˜ëŠ” `subgraph ID ["Label"]` ì‚¬ìš©.
     * **íŠ¹ìˆ˜ë¬¸ì Quoting**: ê´„í˜¸ `()`, ëŒ€ê´„í˜¸ `[]` ë“±ì´ í¬í•¨ëœ ë…¸ë“œ ë¼ë²¨ì€ ë°˜ë“œì‹œ ìŒë”°ì˜´í‘œë¡œ ê°ì‹¸ì•¼ í•©ë‹ˆë‹¤. ì˜ˆ: `Node["Label (Info)"]`
     * **Subgraph ì—°ê²° ê¸ˆì§€**: Subgraph ê°„ ì§ì ‘ ì—°ê²° í™”ì‚´í‘œ ê¸ˆì§€ â†’ ë‚´ë¶€ ë…¸ë“œë¼ë¦¬ ì—°ê²°.

---

## ğŸ¯ ê°œë°œ í”„ë¡œì„¸ìŠ¤ (7 Steps)

**ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì‘ì—…ì€ ì´ ìˆœì„œë¥¼ ë”°ë¥¼ ê²ƒ!**

```text
1ï¸âƒ£ Constitution (ì›ì¹™) â†’ ê¸°ë³¸ ì›ì¹™ ìˆ˜ë¦½
2ï¸âƒ£ Specify (ëª…ì„¸) â†’ ë¬´ì—‡ì„ ë§Œë“¤ì§€ ì •ì˜
3ï¸âƒ£ Clarify (ëª…í™•í™”) â†’ ë¶ˆë¶„ëª…í•œ ë¶€ë¶„ ì§ˆë¬¸ìœ¼ë¡œ í•´ì†Œ
4ï¸âƒ£ Plan (ê³„íš) â†’ ê¸°ìˆ  ìŠ¤íƒê³¼ ì•„í‚¤í…ì²˜ ê²°ì •
5ï¸âƒ£ Tasks (ì‘ì—… ë¶„í•´) â†’ ì‘ì€ ë‹¨ìœ„ë¡œ ìª¼ê°œê¸° (TodoWrite ì‚¬ìš©)
6ï¸âƒ£ Implement (êµ¬í˜„) â†’ ì½”ë“œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸ (Clean Architecture ì¤€ìˆ˜)
7ï¸âƒ£ Analyze (ê²€ì¦) â†’ ëª…ì„¸ ëŒ€ë¹„ ê²€ì¦
```

**âŒ ê¸ˆì§€**: ëª…ì„¸ ì—†ì´ ë°”ë¡œ ì½”ë”©, ì¶”ì¸¡ìœ¼ë¡œ ì§„í–‰, ê²€ì¦ ì—†ì´ ì™„ë£Œ

---

## ğŸš¨ ì‘ì—… ì™„ë£Œ 3ë‹¨ê³„ (í•„ìˆ˜)

**ëª¨ë“  ì‘ì—…ì€ ì•„ë˜ 3ë‹¨ê³„ë¥¼ ì™„ë£Œí•´ì•¼ë§Œ "ì™„ë£Œ"**

```text
1ï¸âƒ£ ì½”ë“œ/í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ
   â†“
2ï¸âƒ£ git commit (í•œê¸€ ë©”ì‹œì§€)
   â†“
3ï¸âƒ£ ë¬¸ì„œ ì—…ë°ì´íŠ¸ (í•„ìˆ˜!) - ëˆ„ë½ ì‹œ ì‘ì—… ë¯¸ì™„ë£Œ ê°„ì£¼
   âœ… logs/CHANGELOG.md
   âœ… docs/Progress/SESSION_SUMMARY_YYYY-MM-DD.md
   âœ… README.md (ë²„ì „ ë™ê¸°í™”)
   âœ… .agent/AGENTS.md (í•„ìš” ì‹œ ì—…ë°ì´íŠ¸)
```

**âŒ ê¸ˆì§€**: ì»¤ë°‹ í›„ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì—†ì´ ë‹¤ìŒ ì‘ì—…ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°

---

## ğŸ”— URL ì‘ì„± ê·œì¹™ (MANDATORY)

**âŒ ì ˆëŒ€ ê¸ˆì§€**:

```text
ì›¹ì•±ì€ http://localhost:3000ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤!  â† URL ë’¤ì— í•œê¸€ ë¶™ìŒ
```

**âœ… ë°˜ë“œì‹œ**:

```text
ì›¹ì•±ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤:

http://localhost:3000

ìœ„ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì„¸ìš”.
```

**í•µì‹¬**: URL ì•ë’¤ë¡œ ë°˜ë“œì‹œ ê³µë°±/ì¤„ë°”ê¿ˆ, URL ë°”ë¡œ ë’¤ì— í•œê¸€/íŠ¹ìˆ˜ë¬¸ì ê¸ˆì§€

---

## ğŸ’» ì½”ë”© ì»¨ë²¤ì…˜

### Backend (Python/FastAPI)

* **íƒ€ì… íŒíŒ… í•„ìˆ˜**: `def get_user(user_id: int) -> User:`
* **Docstring**: ì¤‘ìš” í•¨ìˆ˜ì— ì‘ì„±
* **íŒŒì¼ëª…**: `snake_case` (ì˜ˆ: `bean_service.py`)
* **í´ë˜ìŠ¤**: `PascalCase` (ì˜ˆ: `BeanService`)
* **í•¨ìˆ˜**: `snake_case` (ì˜ˆ: `get_bean_by_id`)
* **Lint**: `check_quality.sh` í†µê³¼ í•„ìˆ˜ (Black, Pylint, Mypy)

### Frontend (TypeScript/Next.js)

* **íƒ€ì… ì •ì˜ í•„ìˆ˜**: `interface`, `type` í™œìš©
* **í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸** ì‚¬ìš©
* **ì»´í¬ë„ŒíŠ¸**: `PascalCase` (ì˜ˆ: `BeanCard.tsx`)
* **ìœ í‹¸**: `camelCase` (ì˜ˆ: `formatPrice.ts`)
* **ì—ëŸ¬ í•¸ë“¤ë§**: try-catch í•„ìˆ˜
* **Lint**: `npm run lint` í†µê³¼ í•„ìˆ˜

---

## ğŸ”– ë²„ì „ ê´€ë¦¬

### ì»¤ë°‹ ë©”ì‹œì§€ ì»¨ë²¤ì…˜

```bash
feat: ì›ë‘ ê´€ë¦¬ í˜ì´ì§€ ì¶”ê°€
fix: ê°€ê²© ê³„ì‚° ì˜¤ë¥˜ ìˆ˜ì •
refactor: Bean ì„œë¹„ìŠ¤ ë¦¬íŒ©í† ë§
docs: README ì—…ë°ì´íŠ¸
chore: íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
test: í…ŒìŠ¤íŠ¸ ì¶”ê°€
```

### ë²„ì „ ì—…ë°ì´íŠ¸ ê¸°ì¤€

**ì‘ì—… ì™„ë£Œ í›„**: `git commit` (ë²„ì „ ì—…ë°ì´íŠ¸ âŒ)

**ì„¸ì…˜ ì¢…ë£Œ ì‹œ**: ëˆ„ì  ê¸°ì¤€ í™•ì¸ í›„ ë²„ì „ ì˜¬ë¦¼

```text
PATCH: ë²„ê·¸ 3ê°œ ì´ìƒ OR ë¬¸ì„œ 5ê°œ ì´ìƒ ëˆ„ì  (ì£¼ 1~3íšŒ)
MINOR: ìƒˆ ê¸°ëŠ¥ 3~4ê°œ ì´ìƒ ì¶”ê°€ (ì›” 1íšŒ)
MAJOR: í˜¸í™˜ì„± ë³€ê²½ (ë…„ 1~2íšŒ)
```

---

## ğŸ“‹ ì„¸ì…˜ ê´€ë¦¬ (Session Protocol)

### ì„¸ì…˜ ì‹œì‘ ì‹œ

```bash
# 1. ì²´í¬ë¦¬ìŠ¤íŠ¸ í™•ì¸
cat docs/Progress/SESSION_START_CHECKLIST.md

# 2. ìµœì‹  ì„¸ì…˜ ìš”ì•½ ì½ê¸°
ls -lt docs/Progress/SESSION_SUMMARY_*.md | head -1
```

### ì„¸ì…˜ ì¢…ë£Œ ì‹œ

```bash
# 1. ì¢…ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ
cat docs/Progress/SESSION_END_CHECKLIST.md

# 2. ì„¸ì…˜ ìš”ì•½ ì‘ì„± (docs/Progress/SESSION_SUMMARY_YYYY-MM-DD.md)

# 3. ë²„ì „ ì—…ë°ì´íŠ¸ (ëˆ„ì  ê¸°ì¤€ ì¶©ì¡± ì‹œ)
./venv/bin/python logs/update_version.py --type patch --summary "ìš”ì•½"

# 4. ëª¨ë“  ë¬¸ì„œ ë²„ì „ ë™ê¸°í™”
```

---

## ğŸš« ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­

**ì›ë³¸ í”„ë¡œì íŠ¸ ì½”ë“œ ë³µì‚¬ ê¸ˆì§€** (ì°¸ì¡°ë§Œ ê°€ëŠ¥)

**ìƒˆë¡œìš´ ì„¸ì…˜ ê´€ë¦¬ íŒŒì¼ ìƒì„± ê¸ˆì§€** (ê¸°ì¡´ ì²´ê³„ ìœ ì§€)

**ì‘ì€ ë³€ê²½ì‚¬í•­ë§ˆë‹¤ ë²„ì „ ì˜¬ë¦¬ê¸° ê¸ˆì§€** (ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì¼ê´„ ì²˜ë¦¬)

**ì˜ì–´ ë‹µë³€ ê¸ˆì§€** (í•œê¸€ ì„¤ëª… í•„ìˆ˜)

---

## ğŸ”„ Context Handover Protocol (Last updated by Agent)

> **ì´ ì„¹ì…˜ì€ AIê°€ ì„¸ì…˜ì„ ì‹œì‘í•  ë•Œ ìë™ìœ¼ë¡œ ì½ì–´ë“¤ì´ëŠ” "ê¸°ì–µ" ì˜ì—­ì…ë‹ˆë‹¤.**
> **ì„¸ì…˜ ì¢…ë£Œ ì „ ë°˜ë“œì‹œ AIì—ê²Œ "ìƒíƒœ ì €ì¥í•´ì¤˜" ë˜ëŠ” "ì„¸ì…˜ ì¢…ë£Œ"ë¥¼ ìš”ì²­í•˜ì—¬ ì´ ë¶€ë¶„ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.**

### ğŸ“… ë§ˆì§€ë§‰ ì„¸ì…˜: 2025-12-24 (Bean Refactoring & Clean Architecture)

**âœ… ì™„ë£Œëœ ì‘ì—… (v0.4.8)**:
1. **Bean Module Refactoring (Clean Architecture)**:
   - **Repository Pattern ì ìš©**: `BeanRepository`ì— ê²€ìƒ‰ ë° ì§‘ê³„ ë©”ì„œë“œ ì¶”ê°€.
   - **Service Layer ê°œì„ **: `BeanService`ì˜ ì§ì ‘ DB ì ‘ê·¼ ì½”ë“œ ì œê±°.
   - **Verification**: `tests/verify_bean_refactor.py` ìŠ¤í¬ë¦½íŠ¸ë¡œ ê¸°ëŠ¥ ê²€ì¦ ì™„ë£Œ.
2. **Bug Fixes**:
   - `logs/update_version.py`: `SyntaxError` (missing except block) ìˆ˜ì •.
3. **OCR Engine & UI (ì´ì „ ì‘ì—…)**:
   - Auto-Deskew, Sharpening, Adaptive Upscale ë“± ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ê³ ë„í™”.
   - ì„¤ì • í˜ì´ì§€ UI ê°œì„ .

**Git ìƒíƒœ**:
- í˜„ì¬ ë¸Œëœì¹˜: main
- ìµœì‹  ì»¤ë°‹: fix: update_version.py êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì • (except ë¸”ë¡ ì¶”ê°€)

**ğŸ¯ ë‹¤ìŒ ì‘ì—… (Immediate Next Step)**:
1. **ë¡œìŠ¤íŒ… ë¡œê·¸ ì‹œìŠ¤í…œ (Phase 2)**: ë¦¬íŒ©í† ë§ëœ `BeanRepository` í™œìš©í•˜ì—¬ ë¡œìŠ¤íŒ… ë°ì´í„° ì—°ë™ êµ¬í˜„.
2. **OCR í…ŒìŠ¤íŠ¸ & íŠœë‹**: ì‹¤ì œ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¡œ ìƒˆë¡œìš´ ì„¤ì •ê°’ í…ŒìŠ¤íŠ¸.
