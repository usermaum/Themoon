# ë”ë¬¸ë“œë¦½ë°” ì›ê°€ê³„ì‚°ê¸° ê³ ë„í™” í”Œëœ

> **ì‘ì„±ì¼**: 2025-11-09
> **ë²„ì „**: 1.0.0
> **ëª©í‘œ**: ë¡œìŠ¤íŒ… ë¹„ìš© ê³„ì‚° ë° ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ ê³ ë„í™”

---

## ğŸ“‹ ëª©ì°¨

1. [í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„](#1-í˜„ì¬-ì‹œìŠ¤í…œ-ë¶„ì„)
2. [ìš”êµ¬ì‚¬í•­ ë¶„ì„](#2-ìš”êµ¬ì‚¬í•­-ë¶„ì„)
3. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#3-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
4. [ê¸°ëŠ¥ë³„ ìƒì„¸ ì„¤ê³„](#4-ê¸°ëŠ¥ë³„-ìƒì„¸-ì„¤ê³„)
5. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#5-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
6. [UI/UX ì„¤ê³„](#6-uiux-ì„¤ê³„)
7. [êµ¬í˜„ ë‹¨ê³„](#7-êµ¬í˜„-ë‹¨ê³„)
8. [ì˜ˆìƒ ì¼ì •](#8-ì˜ˆìƒ-ì¼ì •)

---

## 1. í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### 1.1 êµ¬í˜„ëœ ê¸°ëŠ¥

#### âœ… ë¡œìŠ¤íŒ… ê¸°ë¡ ê´€ë¦¬ (RoastingRecord.py)
- **ê¸°ë¡ ì¶”ê°€**: ìƒë‘ íˆ¬ì…ëŸ‰, ë¡œìŠ¤íŒ… í›„ ë¬´ê²Œ, ë‚ ì§œ, ì›ë‘ ì¢…ë¥˜ ì…ë ¥
- **ì†ì‹¤ë¥  ìë™ ê³„ì‚°**: `(ìƒë‘ - ë¡œìŠ¤íŒ…í›„) / ìƒë‘ Ã— 100`
- **ì†ì‹¤ë¥  ìƒíƒœ íŒì •**: ğŸŸ¢ìš°ìˆ˜/ì •ìƒ, ğŸŸ¡ì£¼ì˜, ğŸ”´ìœ„í—˜
- **í†µê³„ ë¶„ì„**: ì›”ë³„ í‰ê·  ì†ì‹¤ë¥ , ì´ ì†ì‹¤ëŸ‰, ì¶”ì´ ê·¸ë˜í”„
- **í˜ì´ì§•**: ëª¨ë°”ì¼ ìµœì í™”ëœ í˜ì´ì§• ì‹œìŠ¤í…œ
- **ì¡°íšŒ ê¸°ê°„ í•„í„°**: ì „ì²´, ì˜¤ëŠ˜, 1ê°œì›”, 3ê°œì›”, 6ê°œì›”, 1ë…„, ë‚ ì§œì¡°íšŒ

#### âœ… ì›ë‘ ê´€ë¦¬ (Bean ëª¨ë¸)
- **ì›ë‘ ì •ë³´**: 17ì¢… ì›ë‘ ë°ì´í„° (ì´ë¦„, ì›ì‚°ì§€, ê°€ê²©, ë¡œìŠ¤íŒ… ë ˆë²¨)
- **ì›ë‘-ë¡œìŠ¤íŒ… ê¸°ë¡ ì—°ê²°**: ì–´ë–¤ ì›ë‘ë¥¼ ë¡œìŠ¤íŒ…í–ˆëŠ”ì§€ ì¶”ì 

#### âœ… ì¬ê³  ê´€ë¦¬ (Inventory ëª¨ë¸)
- **ê¸°ë³¸ ì¬ê³  ì¶”ì **: ì›ë‘ë³„ ì¬ê³ ëŸ‰ ê´€ë¦¬
- **ì…ì¶œê³  ê¸°ë¡**: Transaction ëª¨ë¸ë¡œ ì…ì¶œê³  ì´ë ¥ ì €ì¥

### 1.2 ë¶€ì¡±í•œ ê¸°ëŠ¥

#### âŒ ì—­ì‚° ê³„ì‚°ê¸° (íˆ¬ì…ëŸ‰ ì˜ˆì¸¡)
- í˜„ì¬: íˆ¬ì…ëŸ‰ â†’ ì†ì‹¤ë¥  ê³„ì‚° (ìˆœë°©í–¥ë§Œ)
- í•„ìš”: ëª©í‘œ ì‚°ì¶œëŸ‰ â†’ í•„ìš”í•œ íˆ¬ì…ëŸ‰ ê³„ì‚° (ì—­ë°©í–¥)

#### âŒ ì›ë‘ë³„ í‰ê·  ì†ì‹¤ë¥  ë¶„ì„
- í˜„ì¬: ì „ì²´ í‰ê·  ì†ì‹¤ë¥ ë§Œ ê³„ì‚°
- í•„ìš”: ì›ë‘ ì¢…ë¥˜ë³„ í‰ê·  ì†ì‹¤ë¥  ì¶”ì  ë° í™œìš©

#### âŒ ì¬ê³  ìë™ ì—°ë™
- í˜„ì¬: ë¡œìŠ¤íŒ… ê¸°ë¡ê³¼ ì¬ê³ ê°€ ë¶„ë¦¬ë¨
- í•„ìš”: ë¡œìŠ¤íŒ… ì‹œ ì¬ê³  ìë™ ì°¨ê°, ì…ê³  ì‹œ ìë™ ì¦ê°€

#### âŒ ì¶œê³  ê´€ë¦¬ ì‹œìŠ¤í…œ
- í˜„ì¬: ì¶œê³  ê¸°ëŠ¥ ì—†ìŒ
- í•„ìš”: ê³ ê° ì¶œê³  ê´€ë¦¬, ë¡œìŠ¤íŒ… í›„ ì›ë‘ ì¬ê³  ì¶”ì 

---

## 2. ìš”êµ¬ì‚¬í•­ ë¶„ì„

### 2.1 ì†ì‹¤ë¥  ì˜ˆì¸¡ ë° ì´ëŸ‰ ì‚°ì¶œ

#### ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­
- **ëª©í‘œ**: ì›í•˜ëŠ” ì‚°ì¶œëŸ‰ì„ ì–»ê¸° ìœ„í•´ í•„ìš”í•œ ìƒë‘ íˆ¬ì…ëŸ‰ ìë™ ê³„ì‚°
- **ì‚¬ìš©ì**: ë¡œìŠ¤í„°, ì¹´í˜ ë§¤ë‹ˆì €
- **ì‹œë‚˜ë¦¬ì˜¤**:
  1. ì‚¬ìš©ìê°€ "10kgì˜ ì›ë‘ê°€ í•„ìš”í•˜ë‹¤"ê³  ì…ë ¥
  2. ì‹œìŠ¤í…œì´ ì›ë‘ë³„ í‰ê·  ì†ì‹¤ë¥ ì„ ì¡°íšŒ (ì˜ˆ: 15%)
  3. ì‹œìŠ¤í…œì´ í•„ìš”í•œ íˆ¬ì…ëŸ‰ ê³„ì‚°: `10 Ã· (1 - 0.15) = 11.765kg`
  4. ì‹œìŠ¤í…œì´ ì‹¤ë¬´ ê¶Œì¥ëŸ‰ ì œì‹œ: `11.8 ~ 12.0kg` (ì—¬ìœ  ê³ ë ¤)

#### ê¸°ìˆ  ìš”êµ¬ì‚¬í•­
```python
def calculate_required_raw_weight(
    target_output_kg: float,
    bean_id: int = None,
    safety_margin: float = 0.02  # 2% ì—¬ìœ 
) -> dict:
    """
    ëª©í‘œ ì‚°ì¶œëŸ‰ ê¸°ë°˜ íˆ¬ì…ëŸ‰ ê³„ì‚°

    Returns:
        {
            'target_output': 10.0,
            'avg_loss_rate': 15.0,
            'calculated_input': 11.765,
            'recommended_input': 12.0,
            'safety_margin': 0.235  # 2% ì—¬ìœ ë¶„
        }
    """
    # 1. ì›ë‘ë³„ í‰ê·  ì†ì‹¤ë¥  ì¡°íšŒ
    # 2. íˆ¬ì…ëŸ‰ ê³„ì‚°: target Ã· (1 - loss_rate)
    # 3. ì—¬ìœ ë¶„ ì¶”ê°€: calculated Ã— (1 + safety_margin)
    # 4. ì†Œìˆ˜ì  ì²˜ë¦¬: ì˜¬ë¦¼ ë˜ëŠ” ë°˜ì˜¬ë¦¼
```

### 2.2 ë¡œìŠ¤íŒ… í›„ ë°ì´í„° ì…ë ¥ ë° ì†ì‹¤ë¥  ìë™ ê³„ì‚°

#### ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­
- **ëª©í‘œ**: ë¡œìŠ¤íŒ… í›„ ì‹¤ì œ ê²°ê³¼ ì…ë ¥ ì‹œ ì†ì‹¤ë¥  ìë™ ê³„ì‚° ë° ì €ì¥
- **í˜„ì¬ ìƒíƒœ**: âœ… ì´ë¯¸ êµ¬í˜„ë¨ (RoastingRecord.py)
- **ê°œì„  í•„ìš”**: ì›ë‘ë³„ ì†ì‹¤ë¥  í†µê³„ ìë™ ì—…ë°ì´íŠ¸

#### ê¸°ìˆ  ìš”êµ¬ì‚¬í•­
```python
def update_bean_loss_statistics(bean_id: int):
    """
    ì›ë‘ë³„ í‰ê·  ì†ì‹¤ë¥  ì¬ê³„ì‚°

    - í•´ë‹¹ ì›ë‘ì˜ ëª¨ë“  ë¡œìŠ¤íŒ… ê¸°ë¡ ì¡°íšŒ
    - í‰ê· , í‘œì¤€í¸ì°¨, ìµœì†Œ/ìµœëŒ€ê°’ ê³„ì‚°
    - Bean ëª¨ë¸ì— í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
    """
```

### 2.3 ì›ë‘ ëª©ë¡ ê´€ë¦¬

#### ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­
- **ëª©í‘œ**: ë‹¤ì–‘í•œ ì›ë‘ ì¢…ë¥˜ ë° ë¸Œëœë“œ ë“±ë¡/ê´€ë¦¬
- **í˜„ì¬ ìƒíƒœ**: âœ… ê¸°ë³¸ êµ¬í˜„ë¨ (17ì¢… ì›ë‘ ë“±ë¡)
- **ê°œì„  í•„ìš”**:
  - ì›ë‘ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ UI
  - ì›ë‘ë³„ í†µê³„ ì •ë³´ í‘œì‹œ
  - ë¸Œëœë“œ ì •ë³´ ì¶”ê°€

#### ê¸°ìˆ  ìš”êµ¬ì‚¬í•­
```python
# Bean ëª¨ë¸ í™•ì¥
class Bean:
    # ê¸°ì¡´ í•„ë“œ
    id, no, name, country_name, roast_level, price_per_kg

    # ì¶”ê°€ í•„ë“œ
    brand: str  # ë¸Œëœë“œ (ì˜ˆ: "ì‚°íƒ€ë°”ë°”ë¼", "ìŠ¤í˜ì…œí‹°", "ìê°€ë¡œìŠ¤íŒ…")
    avg_loss_rate: float  # í‰ê·  ì†ì‹¤ë¥  (ìë™ ê³„ì‚°)
    std_loss_rate: float  # ì†ì‹¤ë¥  í‘œì¤€í¸ì°¨
    total_roasted_count: int  # ì´ ë¡œìŠ¤íŒ… íšŸìˆ˜
    last_roasted_date: date  # ë§ˆì§€ë§‰ ë¡œìŠ¤íŒ… ë‚ ì§œ
```

### 2.4 ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ

#### ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­

**2.4.1 ìƒë‘ ì¬ê³  ê´€ë¦¬**
- **ì…ê³ **: ìƒë‘ ì…ê³  ì‹œ ì¬ê³  ì¦ê°€
- **ì†Œë¹„**: ë¡œìŠ¤íŒ… ì‹œ ìƒë‘ ì¬ê³  ìë™ ì°¨ê°
- **ì¡°íšŒ**: ì›ë‘ë³„ í˜„ì¬ ì¬ê³ ëŸ‰ í™•ì¸

**2.4.2 ë¡œìŠ¤íŒ… í›„ ì›ë‘ ì¬ê³  ê´€ë¦¬**
- **ìƒì‚°**: ë¡œìŠ¤íŒ… ì™„ë£Œ ì‹œ ì›ë‘ ì¬ê³  ì¦ê°€
- **ì¶œê³ **: ê³ ê° íŒë§¤/ë°°ì†¡ ì‹œ ì›ë‘ ì¬ê³  ì°¨ê°
- **ì¡°íšŒ**: íŒë§¤ ê°€ëŠ¥í•œ ì›ë‘ ì¬ê³  í™•ì¸

#### ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ

```
ì´ˆê¸° ìƒíƒœ:
  - ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ (ìƒë‘): 0kg
  - ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ (ì›ë‘): 0kg

1ï¸âƒ£ ì…ê³  (2025-11-01)
  - ìƒë‘ 20kg ì…ê³ 
  â†’ ìƒë‘ ì¬ê³ : 20kg

2ï¸âƒ£ ë¡œìŠ¤íŒ… (2025-11-05)
  - ìƒë‘ 12kg íˆ¬ì… â†’ ì›ë‘ 10.2kg ìƒì‚°
  â†’ ìƒë‘ ì¬ê³ : 8kg (20 - 12)
  â†’ ì›ë‘ ì¬ê³ : 10.2kg (0 + 10.2)

3ï¸âƒ£ ì¶œê³  (2025-11-10)
  - ê³ ê°ì—ê²Œ 5kg íŒë§¤
  â†’ ì›ë‘ ì¬ê³ : 5.2kg (10.2 - 5)

4ï¸âƒ£ ì¬ë¡œìŠ¤íŒ… (2025-11-15)
  - ìƒë‘ 8kg íˆ¬ì… â†’ ì›ë‘ 6.8kg ìƒì‚°
  â†’ ìƒë‘ ì¬ê³ : 0kg (8 - 8)
  â†’ ì›ë‘ ì¬ê³ : 12kg (5.2 + 6.8)
```

#### ê¸°ìˆ  ìš”êµ¬ì‚¬í•­

```python
# ì¬ê³  ìœ í˜• êµ¬ë¶„
class InventoryType(Enum):
    RAW_BEAN = "ìƒë‘"  # ë¡œìŠ¤íŒ… ì „
    ROASTED_BEAN = "ì›ë‘"  # ë¡œìŠ¤íŒ… í›„

# ê±°ë˜ ìœ í˜•
class TransactionType(Enum):
    # ìƒë‘ ê±°ë˜
    PURCHASE = "ì…ê³ "  # ìƒë‘ êµ¬ë§¤ ì…ê³ 
    ROASTING = "ë¡œìŠ¤íŒ…"  # ë¡œìŠ¤íŒ… (ìƒë‘ â†’ ì›ë‘)

    # ì›ë‘ ê±°ë˜
    PRODUCTION = "ìƒì‚°"  # ë¡œìŠ¤íŒ… ì™„ë£Œ (ì›ë‘ ìƒì‚°)
    SALES = "íŒë§¤ì¶œê³ "  # ê³ ê° íŒë§¤
    GIFT = "ì¦ì •ì¶œê³ "  # ìƒ˜í”Œ/ì¦ì •
    WASTE = "íê¸°"  # ë¶ˆëŸ‰ ì›ë‘ íê¸°
    ADJUSTMENT = "ì¬ê³ ì¡°ì •"  # ì¬ê³  ì‹¤ì‚¬ í›„ ì¡°ì •

# Inventory ëª¨ë¸ í™•ì¥
class Inventory:
    id: int
    bean_id: int
    inventory_type: InventoryType  # ìƒë‘ or ì›ë‘
    quantity_kg: float  # í˜„ì¬ ì¬ê³ ëŸ‰
    last_updated: datetime

# Transaction ëª¨ë¸ í™•ì¥
class Transaction:
    id: int
    bean_id: int
    transaction_type: TransactionType
    inventory_type: InventoryType  # ì–´ë–¤ ì¬ê³ ì— ì˜í–¥?
    quantity_kg: float  # ê±°ë˜ëŸ‰ (+ or -)
    unit_price: float  # ë‹¨ê°€
    total_price: float  # ì´ì•¡
    roasting_log_id: int | None  # ë¡œìŠ¤íŒ… ê¸°ë¡ ì—°ê²°
    notes: str
    created_at: datetime
```

---

## 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 3.1 ê³„ì¸µ êµ¬ì¡°

```mermaid
graph TD
    subgraph Presentation_Layer["Presentation Layer (Streamlit Pages - UI/UX)"]
        CostCalculator["CostCalculator.py (ì‹ ê·œ)<br/>- íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸° íƒ­<br/>- ì¬ê³  í˜„í™© íƒ­<br/>- ì…ê³  ê´€ë¦¬ íƒ­<br/>- ì¶œê³  ê´€ë¦¬ íƒ­"]
        RoastingRecord["RoastingRecord.py (ê¸°ì¡´)<br/>- ë¡œìŠ¤íŒ… ê¸°ë¡ ê´€ë¦¬"]
        BeanManagement["BeanManagement.py (ì‹ ê·œ)<br/>- ì›ë‘ ì •ë³´ ê´€ë¦¬"]
    end

    subgraph Business_Logic_Layer["Business Logic Layer (Services - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)"]
        CostService["cost_calculator_service.py (ì‹ ê·œ)<br/>- calculate_required_input()<br/>- get_bean_statistics()<br/>- predict_output()"]
        InventoryService["inventory_service.py (ì‹ ê·œ)<br/>- add_stock()<br/>- reduce_stock()<br/>- get_current_inventory()<br/>- process_roasting_transaction()"]
        RoastingService["roasting_service.py (ê¸°ì¡´)"]
        BeanService["bean_service.py (ê¸°ì¡´)"]
    end

    subgraph Data_Access_Layer["Data Access Layer (Models - ë°ì´í„°ë² ì´ìŠ¤)"]
        BeanModel["Bean (ê¸°ì¡´, í™•ì¥)"]
        RoastingLogModel["RoastingLog (ê¸°ì¡´)"]
        InventoryModel["Inventory (ê¸°ì¡´, í™•ì¥)"]
        TransactionModel["Transaction (ê¸°ì¡´, í™•ì¥)"]
        BeanStatsModel["BeanStatistics (ì‹ ê·œ)"]
    end

    Presentation_Layer <--> Business_Logic_Layer
    Business_Logic_Layer <--> Data_Access_Layer
```

### 3.2 ë°ì´í„° íë¦„

#### ì‹œë‚˜ë¦¬ì˜¤ 1: íˆ¬ì…ëŸ‰ ê³„ì‚°
```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Page as CostCalculator í˜ì´ì§€
    participant Service as cost_calculator_service
    participant Model as Bean ëª¨ë¸

    User->>Page: "10kg ì›ë‘ í•„ìš”" ì…ë ¥
    Page->>Service: calculate_required_input()
    Service->>Model: í‰ê·  ì†ì‹¤ë¥  ì¡°íšŒ
    Model-->>Service: ì†ì‹¤ë¥  ë°˜í™˜
    Service-->>Page: ê³„ì‚° ê²°ê³¼ ë°˜í™˜ ("11.8kg íˆ¬ì… ê¶Œì¥")
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë¡œìŠ¤íŒ… ë° ì¬ê³  ìë™ ì—°ë™
```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Page as RoastingRecord í˜ì´ì§€
    participant RService as roasting_service
    participant IService as inventory_service
    participant BService as bean_service

    User->>Page: ìƒë‘ 12kg, ì›ë‘ 10.2kg ì…ë ¥
    Page->>RService: create_roasting_log()
    RService->>RService: ì†ì‹¤ë¥  ê³„ì‚° (15%)
    RService->>IService: process_roasting_transaction()
    IService->>IService: ìƒë‘ ì¬ê³  -12kg
    IService->>IService: ì›ë‘ ì¬ê³  +10.2kg
    RService->>BService: update_statistics()
    BService->>BService: í‰ê·  ì†ì‹¤ë¥  ì¬ê³„ì‚°
```

---

## 4. ê¸°ëŠ¥ë³„ ìƒì„¸ ì„¤ê³„

### 4.1 íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸°

#### 4.1.1 UI ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§® íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸°                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  â˜• ì›ë‘ ì„ íƒ                         â”‚
â”‚  [â–¼ ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ (ì—í‹°ì˜¤í”¼ì•„)]  â”‚
â”‚                                      â”‚
â”‚  ğŸ“Š í‰ê·  ì†ì‹¤ë¥ : 15.2% (ìµœê·¼ 10íšŒ)    â”‚
â”‚  ğŸ“‰ í‘œì¤€í¸ì°¨: Â±1.8%                   â”‚
â”‚                                      â”‚
â”‚  ğŸ¯ ëª©í‘œ ì‚°ì¶œëŸ‰ (kg)                  â”‚
â”‚  [ 10.0  ]                           â”‚
â”‚                                      â”‚
â”‚  âœ¨ ì—¬ìœ ìœ¨ ì„¤ì •                        â”‚
â”‚  [ 2%  ] (ë°°ì¹˜ í¸ì°¨ ê³ ë ¤)              â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                      â”‚
â”‚  ğŸ’¡ ê³„ì‚° ê²°ê³¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ í•„ìš”í•œ ìƒë‘ íˆ¬ì…ëŸ‰                â”‚ â”‚
â”‚  â”‚ 11.765 kg (ê¸°ë³¸ ê³„ì‚°)            â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ â­ ê¶Œì¥ íˆ¬ì…ëŸ‰                    â”‚ â”‚
â”‚  â”‚ 12.0 kg (ì—¬ìœ  2% í¬í•¨)          â”‚ â”‚
â”‚  â”‚                                 â”‚ â”‚
â”‚  â”‚ ğŸ“¦ ì˜ˆìƒ ê²°ê³¼                     â”‚ â”‚
â”‚  â”‚ â€¢ ìµœì†Œ: 9.8 kg                  â”‚ â”‚
â”‚  â”‚ â€¢ ì˜ˆìƒ: 10.0 kg                 â”‚ â”‚
â”‚  â”‚ â€¢ ìµœëŒ€: 10.2 kg                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚  [ğŸ“‹ ë¡œìŠ¤íŒ… ê¸°ë¡ìœ¼ë¡œ ì´ë™]             â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.2 ê³„ì‚° ë¡œì§

```python
class CostCalculatorService:
    @staticmethod
    def calculate_required_input(
        target_output_kg: float,
        bean_id: int = None,
        safety_margin: float = 0.02
    ) -> dict:
        """
        íˆ¬ì…ëŸ‰ ê³„ì‚° (ì—­ì‚°)

        Args:
            target_output_kg: ëª©í‘œ ì‚°ì¶œëŸ‰ (kg)
            bean_id: ì›ë‘ ID (Noneì´ë©´ ì „ì²´ í‰ê·  ì‚¬ìš©)
            safety_margin: ì•ˆì „ ì—¬ìœ ìœ¨ (ê¸°ë³¸ 2%)

        Returns:
            {
                'target_output': 10.0,
                'bean_name': 'ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„',
                'avg_loss_rate': 15.2,
                'std_loss_rate': 1.8,
                'sample_count': 10,
                'calculated_input': 11.765,
                'recommended_input': 12.0,
                'min_output': 9.8,
                'max_output': 10.2
            }
        """
        # 1. ì›ë‘ë³„ í†µê³„ ì¡°íšŒ
        stats = BeanStatistics.get_statistics(bean_id)
        avg_loss_rate = stats.avg_loss_rate / 100  # 15.2 â†’ 0.152
        std_loss_rate = stats.std_loss_rate / 100  # 1.8 â†’ 0.018

        # 2. ê¸°ë³¸ íˆ¬ì…ëŸ‰ ê³„ì‚°
        calculated_input = target_output_kg / (1 - avg_loss_rate)

        # 3. ì—¬ìœ ë¶„ ì¶”ê°€
        recommended_input = calculated_input * (1 + safety_margin)

        # 4. ì˜ˆìƒ ë²”ìœ„ ê³„ì‚° (í‘œì¤€í¸ì°¨ ê³ ë ¤)
        min_loss = avg_loss_rate - std_loss_rate
        max_loss = avg_loss_rate + std_loss_rate

        min_output = recommended_input * (1 - max_loss)
        max_output = recommended_input * (1 - min_loss)

        return {
            'target_output': target_output_kg,
            'bean_name': stats.bean_name,
            'avg_loss_rate': stats.avg_loss_rate,
            'std_loss_rate': stats.std_loss_rate,
            'sample_count': stats.sample_count,
            'calculated_input': round(calculated_input, 3),
            'recommended_input': round(recommended_input, 1),
            'min_output': round(min_output, 1),
            'max_output': round(max_output, 1)
        }
```

### 4.2 ì¬ê³  ê´€ë¦¬ ì‹œìŠ¤í…œ

#### 4.2.1 ì…ê³  ê´€ë¦¬ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ ìƒë‘ ì…ê³  ê´€ë¦¬                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ğŸ“… ì…ê³  ë‚ ì§œ                         â”‚
â”‚  [ 2025-11-09 ]                      â”‚
â”‚                                      â”‚
â”‚  â˜• ì›ë‘ ì¢…ë¥˜                         â”‚
â”‚  [â–¼ ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„]               â”‚
â”‚                                      â”‚
â”‚  âš–ï¸ ì…ê³ ëŸ‰ (kg)                      â”‚
â”‚  [ 20.0  ]                           â”‚
â”‚                                      â”‚
â”‚  ğŸ’° ë‹¨ê°€ (ì›/kg)                     â”‚
â”‚  [ 7,500  ]                          â”‚
â”‚                                      â”‚
â”‚  ğŸ’µ ì´ì•¡: â‚©150,000                   â”‚
â”‚                                      â”‚
â”‚  ğŸ“ ë©”ëª¨                              â”‚
â”‚  [ ì‚°íƒ€ë°”ë°”ë¼ 11ì›” 1ì°¨ ì…ê³  ]          â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                      â”‚
â”‚  ğŸ“Š í˜„ì¬ ì¬ê³  (ì…ê³  ì „)                â”‚
â”‚  â€¢ ìƒë‘: 8.0 kg                      â”‚
â”‚  â€¢ ì›ë‘: 5.2 kg                      â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                      â”‚
â”‚  [âœ… ì…ê³  ì²˜ë¦¬]  [ğŸ”„ ì´ˆê¸°í™”]           â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.2 ì¶œê³  ê´€ë¦¬ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšš ì›ë‘ ì¶œê³  ê´€ë¦¬                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ğŸ“… ì¶œê³  ë‚ ì§œ                         â”‚
â”‚  [ 2025-11-09 ]                      â”‚
â”‚                                      â”‚
â”‚  â˜• ì›ë‘ ì¢…ë¥˜                         â”‚
â”‚  [â–¼ ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„]               â”‚
â”‚                                      â”‚
â”‚  ğŸ·ï¸ ì¶œê³  ìœ í˜•                        â”‚
â”‚  [â–¼ íŒë§¤ì¶œê³  ]                        â”‚
â”‚    â€¢ íŒë§¤ì¶œê³                          â”‚
â”‚    â€¢ ì¦ì •ì¶œê³  (ìƒ˜í”Œ)                  â”‚
â”‚    â€¢ íê¸°                            â”‚
â”‚                                      â”‚
â”‚  âš–ï¸ ì¶œê³ ëŸ‰ (kg)                      â”‚
â”‚  [ 5.0  ]                            â”‚
â”‚                                      â”‚
â”‚  ğŸ’° íŒë§¤ ë‹¨ê°€ (ì›/kg)                 â”‚
â”‚  [ 35,000  ]                         â”‚
â”‚                                      â”‚
â”‚  ğŸ’µ ì´ íŒë§¤ì•¡: â‚©175,000               â”‚
â”‚                                      â”‚
â”‚  ğŸ‘¤ ê³ ê° ì •ë³´ (ì„ íƒ)                  â”‚
â”‚  [ ì¹´í˜ ã…‡ã…‡ ]                        â”‚
â”‚                                      â”‚
â”‚  ğŸ“ ë©”ëª¨                              â”‚
â”‚  [ ì •ê¸° ë°°ì†¡ ê³ ê° ]                   â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                      â”‚
â”‚  ğŸ“Š í˜„ì¬ ì›ë‘ ì¬ê³                     â”‚
â”‚  â€¢ ì¶œê³  ì „: 12.0 kg                  â”‚
â”‚  â€¢ ì¶œê³  í›„: 7.0 kg                   â”‚
â”‚                                      â”‚
â”‚  âš ï¸ ì¬ê³  ë¶€ì¡± ì•Œë¦¼                    â”‚
â”‚  ì¬ê³ ê°€ 10kg ì´í•˜ì…ë‹ˆë‹¤!               â”‚
â”‚  ì¶”ê°€ ë¡œìŠ¤íŒ…ì„ ê³ ë ¤í•˜ì„¸ìš”.              â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                      â”‚
â”‚  [âœ… ì¶œê³  ì²˜ë¦¬]  [ğŸ”„ ì´ˆê¸°í™”]           â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.3 ì¬ê³  í˜„í™© ëŒ€ì‹œë³´ë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ì¬ê³  í˜„í™©                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ” ì›ë‘ ì„ íƒ: [â–¼ ì „ì²´ ì›ë‘]                              â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„                                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸŒ± ìƒë‘ ì¬ê³ : 8.0 kg      âš ï¸ ì¬ì…ê³  í•„ìš”             â”‚ â”‚
â”‚  â”‚ â˜• ì›ë‘ ì¬ê³ : 7.0 kg      âš ï¸ ì¶”ê°€ ë¡œìŠ¤íŒ… í•„ìš”        â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚ ğŸ“ˆ ìµœê·¼ 30ì¼ ì†Œë¹„ëŸ‰: 15.2 kg                         â”‚ â”‚
â”‚  â”‚ ğŸ“‰ ì˜ˆìƒ ì¬ê³  ì†Œì§„ì¼: 14ì¼                            â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚ ğŸ’° ì¬ê³  ê°€ì¹˜                                         â”‚ â”‚
â”‚  â”‚ â€¢ ìƒë‘: â‚©60,000 (8kg Ã— â‚©7,500)                     â”‚ â”‚
â”‚  â”‚ â€¢ ì›ë‘: â‚©245,000 (7kg Ã— â‚©35,000)                   â”‚ â”‚
â”‚  â”‚ â€¢ ì´ê³„: â‚©305,000                                    â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚ [ğŸ“¦ ì…ê³ ] [ğŸšš ì¶œê³ ] [ğŸ”¥ ë¡œìŠ¤íŒ… ê¸°ë¡]                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ì¼€ëƒ AA                                             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸŒ± ìƒë‘ ì¬ê³ : 0.0 kg      ğŸ”´ ì¬ê³  ì—†ìŒ               â”‚ â”‚
â”‚  â”‚ â˜• ì›ë‘ ì¬ê³ : 12.5 kg     âœ… ì¶©ë¶„                    â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚ ğŸ“ˆ ìµœê·¼ 30ì¼ ì†Œë¹„ëŸ‰: 8.3 kg                          â”‚ â”‚
â”‚  â”‚ ğŸ“‰ ì˜ˆìƒ ì¬ê³  ì†Œì§„ì¼: 45ì¼                            â”‚ â”‚
â”‚  â”‚                                                      â”‚ â”‚
â”‚  â”‚ [ğŸ“¦ ì…ê³ ] [ğŸšš ì¶œê³ ] [ğŸ”¥ ë¡œìŠ¤íŒ… ê¸°ë¡]                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                          â”‚
â”‚  ğŸ“Š ì „ì²´ ìš”ì•½                                             â”‚
â”‚  â€¢ ì´ ìƒë‘ ì¬ê³ : 23.5 kg (â‚©185,000)                     â”‚
â”‚  â€¢ ì´ ì›ë‘ ì¬ê³ : 45.2 kg (â‚©1,582,000)                   â”‚
â”‚  â€¢ ì´ ì¬ê³  ê°€ì¹˜: â‚©1,767,000                              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2.4 ë¡œìŠ¤íŒ… ì‹œ ì¬ê³  ìë™ ì—°ë™

```python
class InventoryService:
    @staticmethod
    def process_roasting_transaction(
        roasting_log: RoastingLog
    ) -> tuple[Transaction, Transaction]:
        """
        ë¡œìŠ¤íŒ… ì‹œ ì¬ê³  ìë™ ì°¨ê°/ì¦ê°€

        1. ìƒë‘ ì¬ê³  ì°¨ê°
        2. ì›ë‘ ì¬ê³  ì¦ê°€
        3. ê±°ë˜ ê¸°ë¡ ìƒì„±

        Returns:
            (ìƒë‘ ì°¨ê° ê±°ë˜, ì›ë‘ ì¦ê°€ ê±°ë˜)
        """
        bean_id = roasting_log.bean_id
        raw_weight = roasting_log.raw_weight_kg
        roasted_weight = roasting_log.roasted_weight_kg

        # 1. ìƒë‘ ì¬ê³  í™•ì¸
        raw_inventory = Inventory.get_or_create(
            bean_id, InventoryType.RAW_BEAN
        )

        if raw_inventory.quantity_kg < raw_weight:
            raise InsufficientStockError(
                f"ìƒë‘ ì¬ê³  ë¶€ì¡±: {raw_inventory.quantity_kg}kg < {raw_weight}kg"
            )

        # 2. ìƒë‘ ì¬ê³  ì°¨ê°
        raw_transaction = Transaction(
            bean_id=bean_id,
            transaction_type=TransactionType.ROASTING,
            inventory_type=InventoryType.RAW_BEAN,
            quantity_kg=-raw_weight,  # ë§ˆì´ë„ˆìŠ¤
            roasting_log_id=roasting_log.id,
            notes=f"ë¡œìŠ¤íŒ… #{roasting_log.id}"
        )

        raw_inventory.quantity_kg -= raw_weight
        raw_inventory.last_updated = datetime.now()

        # 3. ì›ë‘ ì¬ê³  ì¦ê°€
        roasted_inventory = Inventory.get_or_create(
            bean_id, InventoryType.ROASTED_BEAN
        )

        roasted_transaction = Transaction(
            bean_id=bean_id,
            transaction_type=TransactionType.PRODUCTION,
            inventory_type=InventoryType.ROASTED_BEAN,
            quantity_kg=+roasted_weight,  # í”ŒëŸ¬ìŠ¤
            roasting_log_id=roasting_log.id,
            notes=f"ë¡œìŠ¤íŒ… #{roasting_log.id} ìƒì‚°"
        )

        roasted_inventory.quantity_kg += roasted_weight
        roasted_inventory.last_updated = datetime.now()

        # 4. DB ì €ì¥
        db.add(raw_transaction)
        db.add(roasted_transaction)
        db.commit()

        return (raw_transaction, roasted_transaction)
```

### 4.3 ì›ë‘ë³„ ì†ì‹¤ë¥  í†µê³„

#### 4.3.1 BeanStatistics ëª¨ë¸

```python
class BeanStatistics(Base):
    """ì›ë‘ë³„ ë¡œìŠ¤íŒ… í†µê³„"""
    __tablename__ = "bean_statistics"

    id = Column(Integer, primary_key=True)
    bean_id = Column(Integer, ForeignKey("beans.id"), unique=True)

    # ì†ì‹¤ë¥  í†µê³„
    avg_loss_rate = Column(Float, default=17.0)  # í‰ê·  ì†ì‹¤ë¥  (%)
    std_loss_rate = Column(Float, default=0.0)   # í‘œì¤€í¸ì°¨
    min_loss_rate = Column(Float, default=0.0)   # ìµœì†Œê°’
    max_loss_rate = Column(Float, default=0.0)   # ìµœëŒ€ê°’

    # ë¡œìŠ¤íŒ… ì´ë ¥
    total_roasted_count = Column(Integer, default=0)  # ì´ íšŸìˆ˜
    total_raw_weight = Column(Float, default=0.0)    # ì´ íˆ¬ì…ëŸ‰
    total_roasted_weight = Column(Float, default=0.0) # ì´ ì‚°ì¶œëŸ‰

    # ë‚ ì§œ
    first_roasted_date = Column(Date, nullable=True)
    last_roasted_date = Column(Date, nullable=True)
    last_updated = Column(DateTime, default=datetime.utcnow)

    # ê´€ê³„
    bean = relationship("Bean", backref="statistics")

    @classmethod
    def update_statistics(cls, db: Session, bean_id: int):
        """ì›ë‘ë³„ í†µê³„ ì¬ê³„ì‚°"""
        # 1. í•´ë‹¹ ì›ë‘ì˜ ëª¨ë“  ë¡œìŠ¤íŒ… ê¸°ë¡ ì¡°íšŒ
        logs = db.query(RoastingLog).filter(
            RoastingLog.bean_id == bean_id
        ).all()

        if not logs:
            return None

        # 2. í†µê³„ ê³„ì‚°
        loss_rates = [log.loss_rate_percent for log in logs]

        stats = cls.get_or_create(db, bean_id)
        stats.avg_loss_rate = round(np.mean(loss_rates), 2)
        stats.std_loss_rate = round(np.std(loss_rates), 2)
        stats.min_loss_rate = round(min(loss_rates), 2)
        stats.max_loss_rate = round(max(loss_rates), 2)

        stats.total_roasted_count = len(logs)
        stats.total_raw_weight = sum(log.raw_weight_kg for log in logs)
        stats.total_roasted_weight = sum(log.roasted_weight_kg for log in logs)

        stats.first_roasted_date = min(log.roasting_date for log in logs)
        stats.last_roasted_date = max(log.roasting_date for log in logs)
        stats.last_updated = datetime.now()

        db.commit()
        return stats
```

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 5.1 ERD (Entity-Relationship Diagram)

```mermaid
erd
    Bean {
        int id PK
        string name
        string country_name
        float price_per_kg
        string brand "â˜…"
    }

    BeanStatistics {
        int id PK
        int bean_id FK "Unique"
        float avg_loss_rate
        float std_loss_rate
        int total_count
    }

    RoastingLog {
        int id PK
        int bean_id FK
        float raw_weight_kg
        float roasted_weight
        float loss_rate
    }

    Inventory {
        int id PK
        int bean_id FK
        string type "â˜…"
        float quantity_kg
    }

    Transaction {
        int id PK
        int bean_id FK
        string type "â˜…"
        string inventory_type "â˜…"
        float quantity_kg
        int roasting_log_id FK
        float unit_price
        float total_price
    }

    LossRateWarning {
        int id PK
        int roasting_log_id FK
        string warning_type
        string severity
    }

    Bean ||--|| BeanStatistics : "1:1"
    Bean ||--o{ RoastingLog : "1:N"
    Bean ||--o{ Inventory : "1:N"
    Inventory ||--o{ Transaction : "1:N"
    RoastingLog ||--o{ LossRateWarning : "1:N"
```
**â˜… = ì‹ ê·œ ë˜ëŠ” í™•ì¥ í•„ë“œ**

### 5.2 í…Œì´ë¸” ì •ì˜ (SQL)

```sql
-- Bean í…Œì´ë¸” í™•ì¥
ALTER TABLE beans
ADD COLUMN brand VARCHAR(100) DEFAULT 'ê¸°ë³¸';

-- BeanStatistics í…Œì´ë¸” (ì‹ ê·œ)
CREATE TABLE bean_statistics (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    bean_id INTEGER UNIQUE NOT NULL,
    avg_loss_rate REAL DEFAULT 17.0,
    std_loss_rate REAL DEFAULT 0.0,
    min_loss_rate REAL DEFAULT 0.0,
    max_loss_rate REAL DEFAULT 0.0,
    total_roasted_count INTEGER DEFAULT 0,
    total_raw_weight REAL DEFAULT 0.0,
    total_roasted_weight REAL DEFAULT 0.0,
    first_roasted_date DATE,
    last_roasted_date DATE,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bean_id) REFERENCES beans(id)
);

-- Inventory í…Œì´ë¸” í™•ì¥
ALTER TABLE inventory
ADD COLUMN inventory_type VARCHAR(20) DEFAULT 'RAW_BEAN';
-- ê°’: 'RAW_BEAN' (ìƒë‘) ë˜ëŠ” 'ROASTED_BEAN' (ì›ë‘)

-- Transaction í…Œì´ë¸” í™•ì¥
ALTER TABLE transactions
ADD COLUMN inventory_type VARCHAR(20) DEFAULT 'RAW_BEAN',
ADD COLUMN roasting_log_id INTEGER,
ADD COLUMN unit_price REAL DEFAULT 0.0,
ADD COLUMN total_price REAL DEFAULT 0.0,
ADD FOREIGN KEY (roasting_log_id) REFERENCES roasting_logs(id);

-- transaction_type ê°’:
-- 'PURCHASE' (ì…ê³ ), 'ROASTING' (ë¡œìŠ¤íŒ…-ìƒë‘ ì°¨ê°)
-- 'PRODUCTION' (ìƒì‚°-ì›ë‘ ì¦ê°€), 'SALES' (íŒë§¤ì¶œê³ )
-- 'GIFT' (ì¦ì •), 'WASTE' (íê¸°), 'ADJUSTMENT' (ì¡°ì •)
```

---

## 6. UI/UX ì„¤ê³„

### 6.1 í˜ì´ì§€ êµ¬ì¡°

```
app/pages/
â”œâ”€â”€ CostCalculator.py (ì‹ ê·œ)
â”‚   â”œâ”€ Tab 1: ğŸ§® íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸°
â”‚   â”œâ”€ Tab 2: ğŸ“Š ì¬ê³  í˜„í™©
â”‚   â”œâ”€ Tab 3: ğŸ“¦ ì…ê³  ê´€ë¦¬
â”‚   â””â”€ Tab 4: ğŸšš ì¶œê³  ê´€ë¦¬
â”‚
â”œâ”€â”€ RoastingRecord.py (ê¸°ì¡´)
â”‚   â”œâ”€ Tab 1: ğŸ“‹ ëª©ë¡ ì¡°íšŒ
â”‚   â”œâ”€ Tab 2: â• ê¸°ë¡ ì¶”ê°€ (ì¬ê³  ìë™ ì—°ë™ â˜…)
â”‚   â”œâ”€ Tab 3: âœï¸ ê¸°ë¡ í¸ì§‘
â”‚   â””â”€ Tab 4: ğŸ“Š í†µê³„ ë¶„ì„
â”‚
â””â”€â”€ BeanManagement.py (ì‹ ê·œ)
    â”œâ”€ Tab 1: ğŸ“‹ ì›ë‘ ëª©ë¡
    â”œâ”€ Tab 2: â• ì›ë‘ ì¶”ê°€
    â”œâ”€ Tab 3: âœï¸ ì›ë‘ í¸ì§‘
    â””â”€ Tab 4: ğŸ“Š ì›ë‘ë³„ í†µê³„
```

### 6.2 ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡°

```
ì‚¬ì´ë“œë°”:
â”œâ”€ ğŸ  í™ˆ
â”œâ”€ ğŸ§® ì›ê°€ê³„ì‚°ê¸° (ì‹ ê·œ)
â”‚   â””â”€ "íˆ¬ì…ëŸ‰ ê³„ì‚°, ì¬ê³  í˜„í™©, ì…ì¶œê³  ê´€ë¦¬"
â”œâ”€ ğŸ”¥ ë¡œìŠ¤íŒ… ê¸°ë¡
â”‚   â””â”€ "ë¡œìŠ¤íŒ… ì´ë ¥, ì†ì‹¤ë¥  ë¶„ì„"
â”œâ”€ â˜• ì›ë‘ ê´€ë¦¬ (ì‹ ê·œ)
â”‚   â””â”€ "ì›ë‘ ì •ë³´, í†µê³„"
â””â”€ ğŸ“Š ëŒ€ì‹œë³´ë“œ
    â””â”€ "ì „ì²´ ìš”ì•½"
```

### 6.3 ëª¨ë°”ì¼ ìµœì í™”

- **í„°ì¹˜ ì¹œí™”ì  ë²„íŠ¼**: ìµœì†Œ 44px Ã— 44px
- **ê°„ì†Œí™”ëœ ì…ë ¥**: selectbox, number_input í™œìš©
- **ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ**: st.columns() ì‚¬ìš©
- **ì¶•ì•½ëœ ì •ë³´ í‘œì‹œ**: caption, metric í™œìš©

---

## 7. êµ¬í˜„ ë‹¨ê³„

### Phase 1: ê¸°ë³¸ ì¬ê³  ê´€ë¦¬ (1ì£¼)

#### T1-1: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] BeanStatistics ëª¨ë¸ ìƒì„±
- [ ] Inventory ëª¨ë¸ í™•ì¥ (inventory_type ì¶”ê°€)
- [ ] Transaction ëª¨ë¸ í™•ì¥
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

#### T1-2: ì¬ê³  ì„œë¹„ìŠ¤ êµ¬í˜„
- [ ] `inventory_service.py` ìƒì„±
- [ ] `add_stock()` - ì…ê³  ì²˜ë¦¬
- [ ] `reduce_stock()` - ì¶œê³  ì²˜ë¦¬
- [ ] `get_current_inventory()` - ì¬ê³  ì¡°íšŒ
- [ ] `process_roasting_transaction()` - ë¡œìŠ¤íŒ… ì‹œ ì¬ê³  ìë™ ì—°ë™

#### T1-3: ì¬ê³  ê´€ë¦¬ UI
- [ ] `CostCalculator.py` ìƒì„±
- [ ] Tab 2: ì¬ê³  í˜„í™© ëŒ€ì‹œë³´ë“œ
- [ ] Tab 3: ì…ê³  ê´€ë¦¬ í¼
- [ ] Tab 4: ì¶œê³  ê´€ë¦¬ í¼

#### T1-4: ë¡œìŠ¤íŒ… ê¸°ë¡ ì—°ë™
- [ ] `RoastingRecord.py` ìˆ˜ì •
- [ ] ë¡œìŠ¤íŒ… ê¸°ë¡ ì¶”ê°€ ì‹œ ì¬ê³  ìë™ ì°¨ê°/ì¦ê°€
- [ ] ì¬ê³  ë¶€ì¡± ì‹œ ê²½ê³  ë©”ì‹œì§€

### Phase 2: íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸° (1ì£¼)

#### T2-1: í†µê³„ ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] `BeanStatistics` ëª¨ë¸ ì´ˆê¸°í™”
- [ ] ê¸°ì¡´ ë¡œìŠ¤íŒ… ê¸°ë¡ ê¸°ë°˜ í†µê³„ ê³„ì‚°
- [ ] ë¡œìŠ¤íŒ… ê¸°ë¡ ì¶”ê°€/ìˆ˜ì • ì‹œ í†µê³„ ìë™ ì—…ë°ì´íŠ¸

#### T2-2: ê³„ì‚°ê¸° ì„œë¹„ìŠ¤ êµ¬í˜„
- [ ] `cost_calculator_service.py` ìƒì„±
- [ ] `calculate_required_input()` - íˆ¬ì…ëŸ‰ ì—­ì‚°
- [ ] `get_bean_statistics()` - ì›ë‘ë³„ í†µê³„ ì¡°íšŒ
- [ ] `predict_output()` - ì‚°ì¶œëŸ‰ ì˜ˆì¸¡

#### T2-3: ê³„ì‚°ê¸° UI
- [ ] Tab 1: íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸°
- [ ] ì›ë‘ ì„ íƒ, ëª©í‘œ ì‚°ì¶œëŸ‰ ì…ë ¥
- [ ] í‰ê·  ì†ì‹¤ë¥ , í‘œì¤€í¸ì°¨ í‘œì‹œ
- [ ] ê¶Œì¥ íˆ¬ì…ëŸ‰ ë° ì˜ˆìƒ ë²”ìœ„ í‘œì‹œ

### Phase 3: ì›ë‘ ê´€ë¦¬ ê³ ë„í™” (3ì¼)

#### T3-1: ì›ë‘ ê´€ë¦¬ í˜ì´ì§€
- [ ] `BeanManagement.py` ìƒì„±
- [ ] Tab 1: ì›ë‘ ëª©ë¡ (í†µê³„ í¬í•¨)
- [ ] Tab 2: ì›ë‘ ì¶”ê°€ (ë¸Œëœë“œ ì •ë³´ í¬í•¨)
- [ ] Tab 3: ì›ë‘ í¸ì§‘
- [ ] Tab 4: ì›ë‘ë³„ ìƒì„¸ í†µê³„

#### T3-2: ì›ë‘ ì •ë³´ í™•ì¥
- [ ] `Bean` ëª¨ë¸ì— `brand` í•„ë“œ ì¶”ê°€
- [ ] ê¸°ì¡´ ì›ë‘ ë°ì´í„°ì— ë¸Œëœë“œ ì •ë³´ ì¶”ê°€
- [ ] ë¸Œëœë“œë³„ í•„í„°ë§ ê¸°ëŠ¥

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥ (3ì¼)

#### T4-1: ëŒ€ì‹œë³´ë“œ ê°œì„ 
- [ ] ì „ì²´ ì¬ê³  ê°€ì¹˜ ê³„ì‚°
- [ ] ì¬ê³  ì†Œì§„ ì˜ˆì¸¡ (ìµœê·¼ 30ì¼ ì†Œë¹„ëŸ‰ ê¸°ë°˜)
- [ ] ì¬ì…ê³  ì•Œë¦¼ ì‹œìŠ¤í…œ

#### T4-2: ë³´ê³ ì„œ ê¸°ëŠ¥
- [ ] ì›”ë³„ ì…ì¶œê³  í˜„í™© ë¦¬í¬íŠ¸
- [ ] ì›ë‘ë³„ ìˆ˜ìµì„± ë¶„ì„
- [ ] Excel/CSV ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥

#### T4-3: ì•Œë¦¼ ì‹œìŠ¤í…œ
- [ ] ì¬ê³  ë¶€ì¡± ì•Œë¦¼ (ì„ê³„ê°’ ì„¤ì •)
- [ ] ì†ì‹¤ë¥  ì´ìƒ ì•Œë¦¼
- [ ] ì¬ì…ê³  ì‹œê¸° ì¶”ì²œ

---

## 8. ì˜ˆìƒ ì¼ì •

### ì „ì²´ ì¼ì •: ì•½ 3ì£¼

```
Week 1: Phase 1 - ì¬ê³  ê´€ë¦¬ ê¸°ë³¸ êµ¬í˜„
â”œâ”€ Day 1-2: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€ Day 3-4: ì¬ê³  ì„œë¹„ìŠ¤ êµ¬í˜„
â””â”€ Day 5-7: ì¬ê³  ê´€ë¦¬ UI êµ¬í˜„

Week 2: Phase 2 - íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸°
â”œâ”€ Day 1-2: í†µê³„ ì‹œìŠ¤í…œ êµ¬í˜„
â”œâ”€ Day 3-4: ê³„ì‚°ê¸° ì„œë¹„ìŠ¤ êµ¬í˜„
â””â”€ Day 5-7: ê³„ì‚°ê¸° UI êµ¬í˜„

Week 3: Phase 3-4 - ì›ë‘ ê´€ë¦¬ & ê³ ê¸‰ ê¸°ëŠ¥
â”œâ”€ Day 1-3: ì›ë‘ ê´€ë¦¬ í˜ì´ì§€ êµ¬í˜„
â”œâ”€ Day 4-5: ëŒ€ì‹œë³´ë“œ ë° ë³´ê³ ì„œ ê¸°ëŠ¥
â””â”€ Day 6-7: í…ŒìŠ¤íŠ¸ ë° ë²„ê·¸ ìˆ˜ì •
```

---

## 9. ì„±ê³µ ì§€í‘œ (KPI)

### 9.1 ê¸°ëŠ¥ ì™„ì„±ë„
- [ ] íˆ¬ì…ëŸ‰ ê³„ì‚°ê¸° ì •í™•ë„ 95% ì´ìƒ
- [ ] ì¬ê³  ìë™ ì—°ë™ 100% (ë¡œìŠ¤íŒ… ì‹œ í•­ìƒ ì‘ë™)
- [ ] ì›ë‘ë³„ í†µê³„ ìë™ ì—…ë°ì´íŠ¸

### 9.2 ì‚¬ìš©ì„±
- [ ] ëª¨ë°”ì¼ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼ ê°€ëŠ¥
- [ ] í˜ì´ì§€ ë¡œë”© ì‹œê°„ 3ì´ˆ ì´ë‚´
- [ ] ì…ë ¥ ì˜¤ë¥˜ ì‹œ ëª…í™•í•œ í”¼ë“œë°±

### 9.3 ë°ì´í„° ì •í™•ì„±
- [ ] ì¬ê³  ë¶ˆì¼ì¹˜ ë°œìƒë¥  0%
- [ ] ì†ì‹¤ë¥  ê³„ì‚° ì •í™•ë„ 100%
- [ ] í†µê³„ ì—…ë°ì´íŠ¸ ì§€ì—° 0ì´ˆ (ì‹¤ì‹œê°„)

---

## 10. ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘ ë°©ì•ˆ

### 10.1 ê¸°ìˆ ì  ë¦¬ìŠ¤í¬

**ë¦¬ìŠ¤í¬ 1: ì¬ê³  ë¶ˆì¼ì¹˜**
- ì›ì¸: ë¡œìŠ¤íŒ… ê¸°ë¡ ì¶”ê°€/ì‚­ì œ ì‹œ ì¬ê³  ë¯¸ë°˜ì˜
- ëŒ€ì‘: íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¡œ ì›ìì„± ë³´ì¥, ì¬ê³  ì‹¤ì‚¬ ê¸°ëŠ¥ ì¶”ê°€

**ë¦¬ìŠ¤í¬ 2: í†µê³„ ê³„ì‚° ì„±ëŠ¥**
- ì›ì¸: ë¡œìŠ¤íŒ… ê¸°ë¡ì´ ë§ì•„ì§ˆ ê²½ìš° í†µê³„ ê³„ì‚° ëŠë¦¼
- ëŒ€ì‘: ìºì‹±, ë¹„ë™ê¸° ì—…ë°ì´íŠ¸, ì¸ë±ìŠ¤ ìµœì í™”

**ë¦¬ìŠ¤í¬ 3: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜**
- ì›ì¸: ê¸°ì¡´ ë°ì´í„°ì™€ ì‹ ê·œ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
- ëŒ€ì‘: ë°±ì—… í•„ìˆ˜, ë‹¨ê³„ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜, ë¡¤ë°± ê³„íš

### 10.2 ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ìŠ¤í¬

**ë¦¬ìŠ¤í¬ 1: ì‚¬ìš©ì í•™ìŠµ ê³¡ì„ **
- ì›ì¸: ê¸°ëŠ¥ì´ ë§ì•„ì ¸ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŒ
- ëŒ€ì‘: ì§ê´€ì ì¸ UI, ë„ì›€ë§ ê¸°ëŠ¥, íŠœí† ë¦¬ì–¼

**ë¦¬ìŠ¤í¬ 2: ë°ì´í„° ì…ë ¥ ì˜¤ë¥˜**
- ì›ì¸: ì‚¬ìš©ìì˜ ì˜ëª»ëœ ì…ë ¥
- ëŒ€ì‘: ìœ íš¨ì„± ê²€ì¦ ê°•í™”, í™•ì¸ ë‹¨ê³„ ì¶”ê°€

---

## 11. ì°¸ê³  ìë£Œ

### 11.1 ê´€ë ¨ ë¬¸ì„œ
- `Documents/Architecture/SYSTEM_ARCHITECTURE.md`
- `Documents/Planning/MASTER_PLAN_v2_Phase2.md`
- `app/pages/RoastingRecord.py`
- `app/models/database.py`

### 11.2 ì™¸ë¶€ ì°¸ê³ 
- Streamlit ê³µì‹ ë¬¸ì„œ: https://docs.streamlit.io
- SQLAlchemy ê³µì‹ ë¬¸ì„œ: https://docs.sqlalchemy.org

---

**ë¬¸ì„œ ì‘ì„±ì**: Claude (AI Assistant)
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-11-09
**ìŠ¹ì¸ì**: [í”„ë¡œì íŠ¸ ê´€ë¦¬ì ìŠ¹ì¸ í•„ìš”]
