# ê±°ë˜ ëª…ì„¸ì„œ ì´ë¯¸ì§€ ìë™ ì…ê³  ê¸°ëŠ¥ - ì „ë¬¸ê°€ í”Œëœ

> **ì‘ì„±ì¼**: 2025-11-12
> **ì‘ì„±ì**: Claude (AI Assistant)
> **í”„ë¡œì íŠ¸**: The Moon Drip BAR - ë¡œìŠ¤íŒ… ë¹„ìš© ê³„ì‚°ê¸°
> **ëª©í‘œ ë²„ì „**: v0.31.0 (MINOR)

---

## ğŸ“‹ ëª©ì°¨

1. [Constitution (ì›ì¹™)](#1-constitution-ì›ì¹™)
2. [Specify (ëª…ì„¸)](#2-specify-ëª…ì„¸)
3. [Clarify (ëª…í™•í™”)](#3-clarify-ëª…í™•í™”)
4. [Plan (ì„¤ê³„)](#4-plan-ì„¤ê³„)
5. [Tasks (ì‘ì—… ë¶„í•´)](#5-tasks-ì‘ì—…-ë¶„í•´)
6. [ì˜ˆìƒ ì¼ì •](#6-ì˜ˆìƒ-ì¼ì •)
7. [ì„±ê³µ ê¸°ì¤€](#7-ì„±ê³µ-ê¸°ì¤€)
8. [ë¦¬ìŠ¤í¬ ê´€ë¦¬](#8-ë¦¬ìŠ¤í¬-ê´€ë¦¬)

---

## 1. Constitution (ì›ì¹™)

### ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ

**ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜**
- ìˆ˜ë™ ì…ë ¥ ì‹œê°„ **80% ì ˆê°** (5ë¶„ â†’ 1ë¶„)
- ì…ë ¥ ì˜¤ë¥˜ **50% ê°ì†Œ** (í•™ìŠµ ê¸°ëŠ¥)
- ì‚¬ìš©ì ë§Œì¡±ë„ í–¥ìƒ

**ì‚¬ìš©ì ê²½í—˜**
- ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì´¬ì˜ â†’ ì—…ë¡œë“œ â†’ ìë™ ì…ë ¥ â†’ í™•ì¸ë§Œ
- ì§ê´€ì ì¸ ìˆ˜ì • UI
- ì‹ ë¢°ë„ í‘œì‹œë¡œ íˆ¬ëª…ì„± í™•ë³´

**ì •í™•ë„ ëª©í‘œ**
- OCR ì¸ì‹ë¥ : **70%+** (Tesseract ê¸°ì¤€)
- ì›ë‘ëª… ë§¤ì¹­ ì •í™•ë„: **85%+**
- ì‹ ë¢°ë„ ë‚®ì„ ì‹œ ìˆ˜ë™ ë³´ì • UI ì œê³µ

### ğŸ”’ í•µì‹¬ ì›ì¹™

1. **ì‚¬ìš©ì ì‹ ë¢°**
   - AIê°€ 100% ìë™í™”í•˜ì§€ ì•ŠìŒ
   - ë°˜ë“œì‹œ "í™•ì¸ ë‹¨ê³„" ì œê³µ
   - ì‹ ë¢°ë„ ì ìˆ˜ í‘œì‹œ

2. **ì—ëŸ¬ í—ˆìš©**
   - ì¸ì‹ ì‹¤íŒ¨ ì‹œ ìˆ˜ë™ ì…ë ¥ìœ¼ë¡œ ìš°ì•„í•˜ê²Œ Fallback
   - ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘
   - í•™ìŠµ ê¸°ëŠ¥ìœ¼ë¡œ ì ì§„ì  ê°œì„ 

3. **ë³´ì•ˆ ìš°ì„ **
   - ì—…ë¡œë“œëœ ì´ë¯¸ì§€ëŠ” ì˜êµ¬ ë³´ê´€ (ê°ì‚¬/ì„¸ë¬´ ëª©ì )
   - ê°œì¸ì •ë³´ ì²˜ë¦¬ ì£¼ì˜ (ê³µê¸‰ì—…ì²´ëª…, ì—°ë½ì²˜ ë“±)
   - íŒŒì¼ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬

4. **ë¹„ìš© íš¨ìœ¨**
   - ë¬´ë£Œ ì†”ë£¨ì…˜ ìš°ì„  (Tesseract OCR)
   - í•„ìš”ì‹œ ìœ ë£Œ API ì „í™˜ ê³ ë ¤ (Claude Vision, Google Vision)

### âš ï¸ ì œì•½ì‚¬í•­

#### ê¸°ìˆ  ì œì•½
- Streamlit í™˜ê²½ (ì„œë²„ë¦¬ìŠ¤, íŒŒì¼ ì—…ë¡œë“œ ì œí•œ 200MB)
- SQLite DB (ì´ë¯¸ì§€ëŠ” íŒŒì¼ ì‹œìŠ¤í…œ, ê²½ë¡œë§Œ DB)
- Python 3.12.3, ê¸°ì¡´ ./venv í™˜ê²½ ìœ ì§€
- ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš” (tesseract-ocr, poppler-utils)

#### ë¹„ì¦ˆë‹ˆìŠ¤ ì œì•½
- ê±°ë˜ ëª…ì„¸ì„œ í˜•ì‹ì´ ì—…ì²´ë§ˆë‹¤ ë‹¤ë¦„ (í‘œì¤€í™” ì–´ë ¤ì›€)
- ìˆ˜ê¸° ë©”ëª¨, ë„ì¥, íë¦¿í•œ ê¸€ì”¨ ë“± ì¸ì‹ ë‚œì´ë„ ë†’ìŒ
- ê°œì¸ì •ë³´ ë³´í˜¸ (ì—…ì²´ëª…, ì „í™”ë²ˆí˜¸ ë“±)

#### ì˜ˆì‚° ì œì•½
- ì›” 100íšŒ ì…ê³  ê°€ì •
- Tesseract OCR: ì™„ì „ ë¬´ë£Œ
- Google Cloud Vision API: ì›” 1,000íšŒ ë¬´ë£Œ, ì´ˆê³¼ ì‹œ $1.50/1,000íšŒ
- Claude Vision API: ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ì¶”ê°€ ë¹„ìš© ì—†ìŒ

---

## 2. Specify (ëª…ì„¸)

### ğŸ“¸ ì…ë ¥ (Input)

**ê±°ë˜ ëª…ì„¸ì„œ ì´ë¯¸ì§€**
- **í˜•ì‹**: JPG, PNG, PDF (ì²« í˜ì´ì§€ë§Œ)
- **í¬ê¸°**: ìµœëŒ€ 10MB
- **í•„ìˆ˜ ì •ë³´** (5ê°œ):
  1. ì›ë‘ëª… (ì˜ˆ: "ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ G1")
  2. ìˆ˜ëŸ‰ (ì˜ˆ: "10kg", "10,000g")
  3. ë‹¨ê°€ (ì˜ˆ: "â‚©15,000", "15000ì›")
  4. ê±°ë˜ì¼ì (ì˜ˆ: "2025-11-12", "2025/11/12")
  5. ê³µê¸‰ì—…ì²´ (ì˜ˆ: "(ì£¼)ì»¤í”¼ì½”ë¦¬ì•„")

- **ì„ íƒ ì •ë³´** (3ê°œ):
  6. ì›ì‚°ì§€ (ì˜ˆ: "Ethiopia", "ì—í‹°ì˜¤í”¼ì•„")
  7. ì´ì•¡ (ì˜ˆ: "â‚©150,000")
  8. ë¹„ê³ /ë©”ëª¨

### ğŸ¨ UI/UX í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: ì´ë¯¸ì§€ ì—…ë¡œë“œ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¤ ê±°ë˜ ëª…ì„¸ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ          â”‚
â”‚                                     â”‚
â”‚  [ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë˜ëŠ” í´ë¦­í•˜ì—¬ ì„ íƒ]  â”‚
â”‚                                     â”‚
â”‚  ì§€ì› í˜•ì‹: JPG, PNG, PDF (ìµœëŒ€ 10MB)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: AI ë¶„ì„ ì¤‘                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¤– AIê°€ ëª…ì„¸ì„œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...â”‚
â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  60%              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ê²°ê³¼ í™•ì¸ ë° ìˆ˜ì •            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… ì¸ì‹ ê²°ê³¼ (ì •í™•í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”) â”‚
â”‚                                     â”‚
â”‚ ì›ë‘ëª…:    [ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ G1  ]â”‚
â”‚ ìˆ˜ëŸ‰:      [10      ] kg            â”‚
â”‚ ë‹¨ê°€:      [15,000  ] ì›/kg         â”‚
â”‚ ê±°ë˜ì¼ì:  [2025-11-12]             â”‚
â”‚ ê³µê¸‰ì—…ì²´:  [(ì£¼)ì»¤í”¼ì½”ë¦¬ì•„          ]â”‚
â”‚ ì›ì‚°ì§€:    [Ethiopia               ]â”‚
â”‚                                     â”‚
â”‚ ì‹ ë¢°ë„: ë†’ìŒ (95%) âœ…                â”‚
â”‚                                     â”‚
â”‚ [ìˆ˜ì • í•„ìš”] [ì…ê³  í™•ì •]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ì…ê³  ì™„ë£Œ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ‰ ì…ê³ ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!            â”‚
â”‚                                     â”‚
â”‚ â€¢ ì›ë‘: ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ G1       â”‚
â”‚ â€¢ ìˆ˜ëŸ‰: 10kg                        â”‚
â”‚ â€¢ ê±°ë˜ ë‚´ì—­ì— ìë™ ê¸°ë¡ë¨            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ ì²˜ë¦¬ ë¡œì§

```python
def process_invoice_image(image_file):
    """
    ê±°ë˜ ëª…ì„¸ì„œ ì´ë¯¸ì§€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
    """
    # 1. ì´ë¯¸ì§€ ì „ì²˜ë¦¬ (íšŒì „, ëŒ€ë¹„, ë…¸ì´ì¦ˆ ì œê±°)
    preprocessed = preprocess_image(image_file)

    # 2. OCR ìˆ˜í–‰ (Tesseract)
    ocr_result = extract_text_with_tesseract(preprocessed)

    # 3. êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ (ì •ê·œì‹ + íŒŒì‹±)
    parsed_data = parse_invoice_data(ocr_result)

    # 4. ì›ë‘ëª… ë§¤ì¹­ (Levenshtein ìœ ì‚¬ë„)
    matched_bean = match_bean_to_db(parsed_data['bean_name'])

    # 5. ë°ì´í„° ê²€ì¦ (í•„ìˆ˜ í•„ë“œ í™•ì¸)
    validated = validate_invoice_data(parsed_data)

    # 6. ì‹ ë¢°ë„ ê³„ì‚° (0~100%)
    confidence = calculate_confidence(validated, ocr_result)

    return {
        'data': validated,
        'matched_bean': matched_bean,
        'confidence': confidence,
        'original_text': ocr_result,
        'warnings': []  # ì˜ˆ: "ë‹¨ê°€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    }
```

### ğŸ“¤ ì¶œë ¥ (Output)

**ìë™ ìƒì„±ë˜ëŠ” ë°ì´í„°**

1. **Invoice í…Œì´ë¸”**
   - ê±°ë˜ ëª…ì„¸ì„œ ë©”íƒ€ë°ì´í„°
   - ì´ë¯¸ì§€ ê²½ë¡œ, ê³µê¸‰ì—…ì²´, ê±°ë˜ì¼ì, ì´ì•¡, ì‹ ë¢°ë„

2. **InvoiceItem í…Œì´ë¸”**
   - ëª…ì„¸ì„œ í•­ëª© (ë‹¤ì¤‘ ì›ë‘ ì§€ì›)
   - ì›ë‘ëª…, ìˆ˜ëŸ‰, ë‹¨ê°€, ê¸ˆì•¡, ì›ì‚°ì§€

3. **Inventory í…Œì´ë¸”**
   - ì¬ê³  ì¶”ê°€ (inventory_type='RAW_BEAN')

4. **Transaction í…Œì´ë¸”**
   - ê±°ë˜ ë‚´ì—­ ê¸°ë¡ (transaction_type='PURCHASE')

5. **InvoiceLearning í…Œì´ë¸”** (ì„ íƒ)
   - ì‚¬ìš©ì ìˆ˜ì • ë‚´ì—­ ì €ì¥ (í•™ìŠµ ë°ì´í„°)

6. **ì´ë¯¸ì§€ íŒŒì¼**
   - ê²½ë¡œ: `data/invoices/YYYYMMDD_HHMMSS_ì›ë‘ëª….jpg`
   - ì˜êµ¬ ë³´ê´€ (ê°ì‚¬/ì„¸ë¬´ ëª©ì )

---

## 3. Clarify (ëª…í™•í™”)

### âœ… ê²°ì •ëœ ì‚¬í•­

#### OCR ì†”ë£¨ì…˜
- **ì„ íƒ**: Tesseract OCR (ë¬´ë£Œ)
- **ì´ìœ **: ì™„ì „ ë¬´ë£Œ, í•œê¸€ ì§€ì›, ì¶©ë¶„í•œ ì •í™•ë„
- **ëŒ€ì•ˆ**: í•„ìš”ì‹œ Claude Vision API ì „í™˜ ê³ ë ¤

#### ì´ë¯¸ì§€ ë³´ê´€ ì •ì±…
- **ì„ íƒ**: ì˜êµ¬ ë³´ê´€ (data/invoices/)
- **ì´ìœ **: ê°ì‚¬/ì„¸ë¬´ ëª©ì , ì¬í™•ì¸ í•„ìš” ì‹œ ì°¸ê³ 
- **ë³´ì•ˆ**: íŒŒì¼ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬

#### êµ¬í˜„ ë²”ìœ„ (MVP)
- âœ… ë‹¤ì¤‘ ì›ë‘ ì…ê³  ì§€ì› (1ê°œ ëª…ì„¸ì„œ = Nê°œ ì›ë‘)
- âœ… ì´ë¯¸ì§€ ì „ì²˜ë¦¬ (íšŒì „, ë°ê¸°, ëŒ€ë¹„)
- âœ… í•™ìŠµ ê¸°ëŠ¥ (ì‚¬ìš©ì í”¼ë“œë°±)

#### ìƒ˜í”Œ ì´ë¯¸ì§€
- **ì œê³µë¨**: 11ê°œ ì‹¤ì œ ê±°ë˜ ëª…ì„¸ì„œ ìƒ˜í”Œ âœ…
- **ë¶„ì„ ì™„ë£Œ**: 2ê°œ íƒ€ì… (GSC, HACIELO)
- **ëª©ì **: ëª…ì„¸ì„œ í˜•ì‹ ë¶„ì„ â†’ ë§ì¶¤ íŒŒì‹± ë¡œì§

### ğŸ“Š ì‹¤ì œ ìƒ˜í”Œ ë¶„ì„ ê²°ê³¼

#### ë¶„ì„ ê°œìš”
- **ì´ ìƒ˜í”Œ ìˆ˜**: 11ê°œ
- **ë°ì´í„° ìœ„ì¹˜**: `images/coffee_bean_receiving_Specification/IMG_165*.PNG/JPG`
- **ë¶„ì„ ì¼ì‹œ**: 2025-11-12

---

#### ëª…ì„¸ì„œ íƒ€ì… 1: GSC (Green Coffee) - 10ê°œ ìƒ˜í”Œ â­ **ì£¼ë ¥ íƒ€ì…**

**íšŒì‚¬ ì •ë³´:**
- ê³µê¸‰ì—…ì²´: GSC GREEN COFFEE
- ë“±ë¡ë²ˆí˜¸: 197-04-00506 (ê³µê¸‰ì), 106-86-70680 (ê³µê¸‰ë°›ëŠ”ì)
- ì£¼ì†Œ: ê²½ê¸° ë¶€ì²œì‹œ ë¶€í¥ë¡œ315ë²ˆê¸¸ 27 (ì¢…í•©ë™ ì˜ì§€ì»¤í”¼ ë“œë¦¼ë¹Œ)
- ë‹´ë‹¹ì: ì´ì˜ˆì¸, ì •íƒœìš±, ê¹€ì¢…ì§„
- ì—°ë½ì²˜: 070-4366-6276, 010-9269-3047

**ë¬¸ì„œ êµ¬ì¡°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [GSC ë¡œê³ ]    ê±° ë˜ ëª… ì„¸ ì„œ         â”‚
â”‚                     (ê³µê¸‰ë°›ëŠ”ììš©)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë“±ë¡ë²ˆí˜¸: 197-04-00506  â”‚ ë“±ë¡ë²ˆí˜¸: 106-86-70680â”‚
â”‚ ê³µê¸‰ì: ë‹¤ì»´ì»¤í”¼        â”‚ ê³µê¸‰ë°›ëŠ”ì: ì§€ì•¤...    â”‚
â”‚ ìƒí˜¸: (ë³¸ì¸ë“±)          â”‚ ìƒí˜¸: (ë³¸ì¸ë“±)         â”‚
â”‚ ì„±ëª…: ê²½ê¸° ë¶€ì²œì‹œ...    â”‚ ì„±ëª…: ì„œìš¸...          â”‚
â”‚ ì‚¬ì—…ì¥: ...             â”‚ ì‚¬ì—…ì¥: ...            â”‚
â”‚ ì—…íƒœ: ìŒì‹ì ì—…          â”‚ ì—…íƒœ: ë„ì†Œë§¤, ì œì¡°     â”‚
â”‚ ì—…íƒœ: ì¶©ë¥˜ ì»¤í”¼ì „ë¬¸    â”‚ ì—…íƒœ: ì»¤í”¼ì›ë‘...      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NO. â”‚ í’ˆ   ëª©          â”‚ ê·œê²©â”‚ìˆ˜ëŸ‰â”‚ì¤‘ëŸ‰â”‚ë‹¨ê°€â”‚ê³µê¸‰ê°€ì•¡â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚ Colombia Supreme â”‚ 1kg â”‚30 â”‚30 â”‚14,500â”‚435,000â”‚
â”‚     â”‚ Hulls            â”‚     â”‚   â”‚   â”‚      â”‚        â”‚
â”‚  2  â”‚ Colombia Supreme â”‚ 1kg â”‚30 â”‚30 â”‚21,000â”‚630,000â”‚
â”‚     â”‚ Popayan...       â”‚     â”‚   â”‚   â”‚      â”‚        â”‚
â”‚  3  â”‚ Ethiopia G4...   â”‚ 1kg â”‚30 â”‚30 â”‚12,000â”‚360,000â”‚
â”‚  4  â”‚ Ethiopia G2...   â”‚ 1kg â”‚30 â”‚30 â”‚14,000â”‚420,000â”‚
â”œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         (ë¹ˆ í–‰ë“¤...)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ë²¤ìŠ¬ë¹„: 0ì›    ì´ ì¤‘ëŸ‰: 120 Kg    í•©ê³„ê¸ˆì•¡: 1,845,000ì›â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— ê³„ì•½ë²ˆí˜¸  : S225HY661592                  â”‚
â”‚ â— ê³„ì•½ì¼ì  : 2025ë…„ 10ì›” 29ì¼              â”‚
â”‚ â— ì…ê³„ê¸ˆì•¡  : 1,845,000 ì›                  â”‚
â”‚                                             â”‚
â”‚ â— ì˜ì—… ë‹´ë‹¹ì : ì´ì˜ˆì¸                      â”‚
â”‚ â— ê³µê¸‰ì/ì‚¬ì—…ì: 070-4366-6276             â”‚
â”‚ â— ë‹´ë‹¹ì/ì—°ë½ì²˜: 010-9269-3047             â”‚
â”‚ â— ê³µê¸‰ì/ì´ë©”ì¼: hy.lee@coffeegsc.co.kr    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í…Œì´ë¸” ì»¬ëŸ¼ êµ¬ì¡°:**
1. **NO.**: ìˆœë²ˆ (1, 2, 3, ...)
2. **í’ˆëª©**: ì›ë‘ëª… (ì˜ë¬¸, ê¸´ í…ìŠ¤íŠ¸)
   - ì˜ˆ: "Colombia Supreme Hulls"
   - ì˜ˆ: "Brazil NY2 FC 17/18 M-Y TYPE"
   - ì˜ˆ: "Ethiopia G1 Guji Uraga Washed"
   - ì˜ˆ: "Guatemala SHB Antigua"
   - ì˜ˆ: "Kenya AA FAQ"
   - ì˜ˆ: "Panama Elida Estates Geisha Natural"
3. **ê·œê²©**: í¬ì¥ ë‹¨ìœ„ (1kg, 5kg, 20kg)
4. **ìˆ˜ëŸ‰**: í¬ì¥ ê°œìˆ˜ (1, 4, 20, 30, 40, 60, 100)
5. **ì¤‘ëŸ‰**: ì´ ì¤‘ëŸ‰ = ê·œê²© Ã— ìˆ˜ëŸ‰ (kg)
6. **ë‹¨ê°€**: ê°€ê²©/kg (ì›)
7. **ê³µê¸‰ê°€ì•¡**: ì´ì•¡ = ì¤‘ëŸ‰ Ã— ë‹¨ê°€ (ì›)

**í•˜ë‹¨ ì •ë³´:**
- **ì¢Œì¸¡ ë°•ìŠ¤**:
  - ê³„ì•½ë²ˆí˜¸: "S225HY661592" í˜•ì‹
  - ê³„ì•½ì¼ì: "2025ë…„ 10ì›” 29ì¼"
  - ì…ê³„ê¸ˆì•¡: ì´ì•¡

- **ìš°ì¸¡ ë°•ìŠ¤**:
  - ì˜ì—… ë‹´ë‹¹ì
  - ê³µê¸‰ì/ì‚¬ì—…ì (ì „í™”ë²ˆí˜¸)
  - ë‹´ë‹¹ì/ì—°ë½ì²˜
  - ê³µê¸‰ì/ì´ë©”ì¼

- **ì¤‘ì•™ í•˜ë‹¨**:
  - ë²¤ìŠ¬ë¹„: 0ì›
  - ì´ ì¤‘ëŸ‰: XXX Kg
  - í•©ê³„ê¸ˆì•¡: XXX ì›

**ë‹¤ì¤‘ ì›ë‘ ë¶„í¬:**
- 1ê°œ ì›ë‘: 2ê°œ ìƒ˜í”Œ
- 2ê°œ ì›ë‘: 1ê°œ ìƒ˜í”Œ
- 4ê°œ ì›ë‘: 3ê°œ ìƒ˜í”Œ
- 5ê°œ ì›ë‘: 1ê°œ ìƒ˜í”Œ
- 6ê°œ ì›ë‘: 3ê°œ ìƒ˜í”Œ

**ì£¼ìš” íŠ¹ì§•:**
âœ… í‘œì¤€í™”ëœ ì–‘ì‹ (OCR ì¸ì‹ ìœ ë¦¬)
âœ… ê¹”ë”í•œ í‘œ í˜•ì‹ (í…Œì´ë¸” íŒŒì‹± ê°€ëŠ¥)
âœ… ëª…í™•í•œ ì»¬ëŸ¼ êµ¬ë¶„ì„ 
âœ… ëª¨ë“  í•„ìˆ˜ ì •ë³´ í¬í•¨
âœ… ë‹¤ì¤‘ ì›ë‘ ì§€ì› (1~6ê°œ)
âœ… í•œê¸€ + ì˜ë¬¸ í˜¼í•© (Tesseract kor+eng í•„ìš”)

**ì¸ì‹ ë‚œì´ë„:**
- ğŸŸ¢ í…Œì´ë¸” êµ¬ì¡°: ì‰¬ì›€ (ëª…í™•í•œ êµ¬ë¶„ì„ )
- ğŸŸ¢ ì›ë‘ëª…: ì‰¬ì›€ (ì˜ë¬¸, ê¸´ í…ìŠ¤íŠ¸)
- ğŸŸ¢ ìˆ«ì: ì‰¬ì›€ (ê¹”ë”í•œ í°íŠ¸)
- ğŸŸ¡ ë„ì¥: ì¤‘ê°„ (ë¹¨ê°„ìƒ‰ ë„ì¥ì´ í…ìŠ¤íŠ¸ ìœ„ì— ê²¹ì¹¨)
- ğŸŸ¢ ë‚ ì§œ: ì‰¬ì›€ ("2025ë…„ 10ì›” 29ì¼" í˜•ì‹)

---

#### ëª…ì„¸ì„œ íƒ€ì… 2: HACIELO (í•˜ì‹œì—˜ë¡œ) - 1ê°œ ìƒ˜í”Œ

**íšŒì‚¬ ì •ë³´:**
- ê³µê¸‰ì—…ì²´: HACIELO
- ì›¹ì‚¬ì´íŠ¸: hacielo.com (ì¶”ì •)
- í˜•ì‹: ì›¹ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦°ìƒ·

**ë¬¸ì„œ êµ¬ì¡°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [HACIELO ë¡œê³ ]   ê°„í¸ì£¼ë¬¸  ìƒë‘ì°¾ê¸°  ì„¸ì¼/í˜œíƒ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ìµœê·¼ 3ê°œì›” ì£¼ë¬¸ë‚´ì—­                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì£¼ë¬¸ë²ˆí˜¸        â”‚ìƒí’ˆëª…    â”‚ë°°ì†¡â”‚ê²°ì œê¸ˆì•¡â”‚ì´ì¤‘ëŸ‰â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 20251108-8B7C2 â”‚ë¸Œë¼ì§ˆ ì‚°í† ìŠ¤â”‚íƒë°°â”‚494,000ì›â”‚40kg â”‚
â”‚ 2025/11/08     â”‚NY2 FC (2)  â”‚   â”‚        â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 20250926-8BD28 â”‚ì—í‹°ì˜¤í”¼ì•„ â”‚íƒë°°â”‚430,000ì›â”‚20kg â”‚
â”‚ 2025/09/26     â”‚ëª¨ëª¨ë¼...   â”‚   â”‚        â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 20250822-9533C â”‚ì—í‹°ì˜¤í”¼ì•„ â”‚íƒë°°â”‚870,000ì›â”‚40kg â”‚
â”‚ 2025/08/22     â”‚ëª¨ëª¨ë¼...   â”‚   â”‚        â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•„ë“œ êµ¬ì¡°:**
1. **ì£¼ë¬¸ë²ˆí˜¸**: YYYYMMDD-XXXXX í˜•ì‹ (ë‚ ì§œ í¬í•¨)
2. **ì£¼ë¬¸ì¼ì**: YYYY/MM/DD í˜•ì‹
3. **ìƒí’ˆëª…**: ì›ë‘ëª… (í•œê¸€)
4. **ë°°ì†¡ë°©ë²•**: íƒë°°
5. **ê²°ì œê¸ˆì•¡**: XXX,000ì›
6. **ì´ì¤‘ëŸ‰**: XXkg

**ì£¼ìš” íŠ¹ì§•:**
âš ï¸ ë¹„í‘œì¤€ í˜•ì‹ (ì›¹ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦°ìƒ·)
âš ï¸ ì£¼ë¬¸ ë‚´ì—­ í˜•ì‹ (ê±°ë˜ ëª…ì„¸ì„œ ì•„ë‹˜)
âš ï¸ ë‹¨ê°€ ì •ë³´ ì—†ìŒ (ê³„ì‚° í•„ìš”: ê²°ì œê¸ˆì•¡ Ã· ì´ì¤‘ëŸ‰)
âš ï¸ ë‹¤ì¤‘ ì£¼ë¬¸ ë‚´ì—­ (ì—¬ëŸ¬ ë‚ ì§œ)
âš ï¸ ë°°ì†¡ ì •ë³´ í¬í•¨

**ì¸ì‹ ë‚œì´ë„:**
- ğŸŸ¡ í…Œì´ë¸” êµ¬ì¡°: ì¤‘ê°„ (ì›¹í˜ì´ì§€ ë ˆì´ì•„ì›ƒ)
- ğŸŸ¡ ì›ë‘ëª…: ì¤‘ê°„ (í•œê¸€, ì¼ë¶€ ì˜ë¦¼)
- ğŸŸ¢ ë‚ ì§œ: ì‰¬ì›€ (ì£¼ë¬¸ë²ˆí˜¸ì— í¬í•¨)
- ğŸŸ¢ ê¸ˆì•¡: ì‰¬ì›€ (ëª…í™•í•œ í˜•ì‹)
- ğŸ”´ ë‹¨ê°€: ì–´ë ¤ì›€ (ê³„ì‚° í•„ìš”)

**íŒŒì‹± ìš°ì„ ìˆœìœ„**: ë‚®ìŒ (GSC ëª…ì„¸ì„œ ì™„ì„± í›„ ì¶”ê°€)

---

#### ğŸ“ˆ ë¶„ì„ í†µê³„

| í•­ëª© | GSC | HACIELO | í•©ê³„ |
|------|-----|---------|------|
| ìƒ˜í”Œ ìˆ˜ | 10 | 1 | 11 |
| í‘œì¤€í™” ì •ë„ | â­â­â­â­â­ | â­â­ | - |
| OCR ë‚œì´ë„ | ğŸŸ¢ ì‰¬ì›€ | ğŸŸ¡ ì¤‘ê°„ | - |
| ë‹¤ì¤‘ ì›ë‘ | âœ… (1~6ê°œ) | âŒ | - |
| í•„ìˆ˜ ì •ë³´ | âœ… ëª¨ë‘ | âš ï¸ ì¼ë¶€ | - |
| êµ¬í˜„ ìš°ì„ ìˆœìœ„ | 1ìˆœìœ„ | 2ìˆœìœ„ | - |

---

#### ğŸ¯ íŒŒì‹± ì „ëµ ìˆ˜ë¦½

**Phase 1: GSC ëª…ì„¸ì„œ ì§‘ì¤‘ êµ¬í˜„**
- í‘œì¤€í™”ëœ ì–‘ì‹ â†’ ë†’ì€ ì„±ê³µë¥  ê¸°ëŒ€
- í…Œì´ë¸” ì¸ì‹ ë¡œì§ ê°œë°œ
- í•„ë“œ ìœ„ì¹˜ ê¸°ë°˜ íŒŒì‹±

**Phase 2: HACIELO ëª…ì„¸ì„œ ì¶”ê°€**
- ì›¹í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ì¸ì‹
- ë‹¨ê°€ ìë™ ê³„ì‚° ë¡œì§
- ë‹¤ì¤‘ ì£¼ë¬¸ ì²˜ë¦¬

---

## 4. Plan (ì„¤ê³„)

### ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

```yaml
ì´ë¯¸ì§€ ì²˜ë¦¬:
  - pytesseract: 0.3.10        # Tesseract OCR Python wrapper
  - tesseract-ocr: 5.0+        # ì‹œìŠ¤í…œ ë ˆë²¨ ì„¤ì¹˜ (apt-get)
  - Pillow: 10.0+              # ì´ë¯¸ì§€ ë¡œë”© ë° ê¸°ë³¸ ì²˜ë¦¬
  - opencv-python: 4.8.1       # ì „ì²˜ë¦¬ (íšŒì „, ë°ê¸°, ëŒ€ë¹„, ë…¸ì´ì¦ˆ)
  - pdf2image: 1.16.3          # PDF â†’ ì´ë¯¸ì§€ ë³€í™˜
  - poppler-utils              # PDF ì²˜ë¦¬ (ì‹œìŠ¤í…œ ë ˆë²¨)

ë°ì´í„° íŒŒì‹±:
  - re (ë‚´ì¥)                  # ì •ê·œí‘œí˜„ì‹ (ìˆ«ì, ë‚ ì§œ ì¶”ì¶œ)
  - dateparser: 1.2.0          # ë‹¤ì–‘í•œ ë‚ ì§œ í˜•ì‹ íŒŒì‹±
  - python-Levenshtein: 0.25.0 # ì›ë‘ëª… ë§¤ì¹­ (ìœ ì‚¬ë„ ê³„ì‚°)

UI:
  - streamlit: 1.38.0          # ê¸°ì¡´ ë²„ì „ ìœ ì§€

ê¸°ì¡´ ìŠ¤íƒ:
  - SQLAlchemy                 # ORM
  - SQLite                     # DB
  - pandas                     # ë°ì´í„° ì²˜ë¦¬
```

### ğŸ“ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

```sql
-- 1. Invoice í…Œì´ë¸” (ê±°ë˜ ëª…ì„¸ì„œ)
CREATE TABLE invoices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    image_path TEXT NOT NULL,              -- ì´ë¯¸ì§€ íŒŒì¼ ê²½ë¡œ
    supplier TEXT,                         -- ê³µê¸‰ì—…ì²´
    invoice_date DATE NOT NULL,            -- ê±°ë˜ì¼ì
    total_amount DECIMAL(10, 2),           -- ì´ì•¡
    status TEXT DEFAULT 'COMPLETED',       -- ìƒíƒœ: PENDING, COMPLETED, FAILED
    confidence_score DECIMAL(5, 2),        -- ì‹ ë¢°ë„ (0~100)
    ocr_raw_text TEXT,                     -- OCR ì›ë³¸ í…ìŠ¤íŠ¸
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. InvoiceItem í…Œì´ë¸” (ëª…ì„¸ì„œ í•­ëª© - ë‹¤ì¤‘ ì›ë‘)
CREATE TABLE invoice_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    invoice_id INTEGER NOT NULL,           -- Invoice FK
    bean_id INTEGER,                       -- Bean FK (ì¸ì‹ í›„ ë§¤ì¹­)
    bean_name_raw TEXT NOT NULL,           -- OCRë¡œ ì¶”ì¶œí•œ ì›ë‘ëª… (ì›ë³¸)
    quantity DECIMAL(10, 2) NOT NULL,      -- ìˆ˜ëŸ‰ (kg)
    unit_price DECIMAL(10, 2),             -- ë‹¨ê°€
    amount DECIMAL(10, 2),                 -- ê¸ˆì•¡ (ìˆ˜ëŸ‰ * ë‹¨ê°€)
    origin TEXT,                           -- ì›ì‚°ì§€
    notes TEXT,                            -- ë¹„ê³ 
    confidence_score DECIMAL(5, 2),        -- í•­ëª©ë³„ ì‹ ë¢°ë„
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (invoice_id) REFERENCES invoices(id) ON DELETE CASCADE,
    FOREIGN KEY (bean_id) REFERENCES beans(id) ON DELETE SET NULL
);

-- 3. InvoiceLearning í…Œì´ë¸” (í•™ìŠµ ë°ì´í„°)
CREATE TABLE invoice_learning (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    invoice_item_id INTEGER NOT NULL,      -- InvoiceItem FK
    ocr_text TEXT NOT NULL,                -- OCRì´ ì¸ì‹í•œ í…ìŠ¤íŠ¸
    corrected_value TEXT NOT NULL,         -- ì‚¬ìš©ìê°€ ìˆ˜ì •í•œ ê°’
    field_name TEXT NOT NULL,              -- í•„ë“œëª…: bean_name, quantity, etc.
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (invoice_item_id) REFERENCES invoice_items(id) ON DELETE CASCADE
);

-- 4. Transaction í…Œì´ë¸” í™•ì¥ (ê¸°ì¡´)
ALTER TABLE transactions ADD COLUMN invoice_item_id INTEGER;
-- invoice_item_idë¡œ ì¶”ì  ê°€ëŠ¥
```

### ğŸ—ï¸ 3ê³„ì¸µ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (UI)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/pages/ImageInvoiceUpload.py (ì‹ ê·œ)             â”‚
â”‚  - ì´ë¯¸ì§€ ì—…ë¡œë“œ UI (st.file_uploader)              â”‚
â”‚  - ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° (st.image)                        â”‚
â”‚  - ì¸ì‹ ê²°ê³¼ í™•ì¸ ë° ìˆ˜ì • í¼ (st.form)               â”‚
â”‚  - ë‹¤ì¤‘ ì›ë‘ í•­ëª© í‘œì‹œ (st.expander)                 â”‚
â”‚  - ì…ê³  í™•ì • ë²„íŠ¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Business Logic Layer (Services)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/services/invoice_service.py (ì‹ ê·œ)             â”‚
â”‚  - process_invoice_image()                          â”‚
â”‚  - save_invoice()                                   â”‚
â”‚  - confirm_invoice()                                â”‚
â”‚  - get_invoice_history()                            â”‚
â”‚                                                     â”‚
â”‚  app/services/ocr_service.py (ì‹ ê·œ)                 â”‚
â”‚  - extract_text_from_image()                        â”‚
â”‚  - parse_invoice_data()                             â”‚
â”‚  - match_bean_to_db()                               â”‚
â”‚  - calculate_confidence()                           â”‚
â”‚                                                     â”‚
â”‚  app/services/learning_service.py (ì‹ ê·œ)            â”‚
â”‚  - save_correction()                                â”‚
â”‚  - get_learning_data()                              â”‚
â”‚  - suggest_correction()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Utility Layer (Utils)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/utils/image_utils.py (ì‹ ê·œ)                    â”‚
â”‚  - preprocess_image()         # OpenCV ì „ì²˜ë¦¬        â”‚
â”‚  - rotate_image()             # ìë™ íšŒì „           â”‚
â”‚  - enhance_contrast()         # ëŒ€ë¹„ í–¥ìƒ           â”‚
â”‚  - denoise_image()            # ë…¸ì´ì¦ˆ ì œê±°         â”‚
â”‚  - pdf_to_image()             # PDF ë³€í™˜            â”‚
â”‚                                                     â”‚
â”‚  app/utils/text_parser.py (ì‹ ê·œ)                    â”‚
â”‚  - extract_bean_name()        # ì›ë‘ëª… ì¶”ì¶œ         â”‚
â”‚  - extract_quantity()         # ìˆ˜ëŸ‰ ì¶”ì¶œ (ì •ê·œì‹)  â”‚
â”‚  - extract_price()            # ê°€ê²© ì¶”ì¶œ           â”‚
â”‚  - extract_date()             # ë‚ ì§œ ì¶”ì¶œ           â”‚
â”‚  - fuzzy_match_bean()         # ìœ ì‚¬ ì›ë‘ëª… ë§¤ì¹­    â”‚
â”‚  - normalize_text()           # í…ìŠ¤íŠ¸ ì •ê·œí™”       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer (Models)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  app/models/invoice.py (ì‹ ê·œ)                       â”‚
â”‚  - Invoice (SQLAlchemy Model)                       â”‚
â”‚  - InvoiceItem (SQLAlchemy Model)                   â”‚
â”‚  - InvoiceLearning (SQLAlchemy Model)               â”‚
â”‚                                                     â”‚
â”‚  ê¸°ì¡´ models: Bean, Inventory, Transaction          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ ë°ì´í„° íë¦„ (Sequence Diagram)

```
ì‚¬ìš©ì          UI Page          invoice_service    ocr_service    image_utils    DB
  â”‚                â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚ 1. ì´ë¯¸ì§€ ì—…ë¡œë“œâ”‚                   â”‚                 â”‚              â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚ 2. ì „ì²˜ë¦¬          â”‚                 â”‚              â”‚         â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚         â”‚
  â”‚                â”‚                   â”‚                 â”‚  íšŒì „/ëŒ€ë¹„   â”‚         â”‚
  â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚         â”‚
  â”‚                â”‚ 3. OCR ìˆ˜í–‰        â”‚                 â”‚              â”‚         â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚                   â”‚  pytesseract    â”‚              â”‚         â”‚
  â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚              â”‚         â”‚
  â”‚                â”‚ 4. í…ìŠ¤íŠ¸ íŒŒì‹±     â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚                   â”‚  extract_bean_name()           â”‚         â”‚
  â”‚                â”‚                   â”‚  extract_quantity()            â”‚         â”‚
  â”‚                â”‚                   â”‚  extract_price()               â”‚         â”‚
  â”‚                â”‚ 5. ì›ë‘ëª… ë§¤ì¹­     â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                â”‚                   â”‚  fuzzy_match_bean()            â”‚         â”‚
  â”‚ 6. ê²°ê³¼ í‘œì‹œ    â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                 â”‚              â”‚         â”‚
  â”‚ 7. ìˆ˜ì • (ì„ íƒ) â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚ 8. í•™ìŠµ ë°ì´í„°     â”‚                 â”‚              â”‚         â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚ 9. ì…ê³  í™•ì •    â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚ 10. ì…ê³  ì²˜ë¦¬      â”‚                 â”‚              â”‚         â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚              â”‚         â”‚
  â”‚                â”‚                   â”‚                 â”‚              â”‚  Invoice
  â”‚                â”‚                   â”‚                 â”‚              â”‚  InvoiceItem
  â”‚                â”‚                   â”‚                 â”‚              â”‚  Inventory
  â”‚                â”‚                   â”‚                 â”‚              â”‚  Transaction
  â”‚ 11. ì™„ë£Œ ë©”ì‹œì§€ â”‚                   â”‚                 â”‚              â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                 â”‚              â”‚         â”‚
```

### ğŸ§© í•µì‹¬ ì•Œê³ ë¦¬ì¦˜

#### 1) ì´ë¯¸ì§€ ì „ì²˜ë¦¬ (image_utils.py)

```python
def preprocess_image(image: Image) -> Image:
    """
    OpenCVë¥¼ ì‚¬ìš©í•œ ì´ë¯¸ì§€ ì „ì²˜ë¦¬

    ëª©í‘œ: OCR ì¸ì‹ë¥  í–¥ìƒ (70% â†’ 85%+)
    """
    # PIL â†’ numpy array
    img_array = np.array(image)

    # 1. ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ë³€í™˜
    gray = cv2.cvtColor(img_array, cv2.COLOR_RGB2GRAY)

    # 2. ë…¸ì´ì¦ˆ ì œê±° (Gaussian Blur)
    denoised = cv2.GaussianBlur(gray, (5, 5), 0)

    # 3. ëŒ€ë¹„ í–¥ìƒ (CLAHE)
    clahe = cv2.createCLAHE(clipLimit=2.0, tileGridSize=(8, 8))
    enhanced = clahe.apply(denoised)

    # 4. ì´ì§„í™” (Otsu's Binarization)
    _, binary = cv2.threshold(enhanced, 0, 255,
                             cv2.THRESH_BINARY + cv2.THRESH_OTSU)

    # 5. ìë™ íšŒì „ ë³´ì •
    try:
        osd = pytesseract.image_to_osd(binary)
        rotation = re.search('Rotate: (\d+)', osd).group(1)
        if rotation != '0':
            binary = rotate_image(binary, int(rotation))
    except:
        pass  # íšŒì „ ê°ì§€ ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ

    return Image.fromarray(binary)
```

#### 2) ì›ë‘ëª… ë§¤ì¹­ (text_parser.py)

```python
from Levenshtein import ratio

def fuzzy_match_bean(ocr_bean_name: str,
                     db_beans: List[Bean]) -> Tuple[Bean, float]:
    """
    OCRë¡œ ì¸ì‹í•œ ì›ë‘ëª…ê³¼ DB ì›ë‘ëª…ì˜ ìœ ì‚¬ë„ ê³„ì‚°

    ì•Œê³ ë¦¬ì¦˜: Levenshtein Distance (í¸ì§‘ ê±°ë¦¬)

    Returns:
        (ê°€ì¥ ìœ ì‚¬í•œ Bean, ìœ ì‚¬ë„ ì ìˆ˜ 0~1)
    """
    best_match = None
    best_score = 0.0

    # OCR í…ìŠ¤íŠ¸ ì •ê·œí™”
    normalized_ocr = normalize_text(ocr_bean_name)

    for bean in db_beans:
        # Bean ì´ë¦„ ì •ê·œí™”
        normalized_bean = normalize_text(bean.name)

        # Levenshtein ìœ ì‚¬ë„ ê³„ì‚° (0~1)
        score = ratio(normalized_ocr, normalized_bean)

        # ì›ì‚°ì§€ ì •ë³´ê°€ ìˆìœ¼ë©´ ê°€ì¤‘ì¹˜ ë¶€ì—¬
        if bean.origin and bean.origin.lower() in normalized_ocr.lower():
            score += 0.1

        if score > best_score:
            best_score = score
            best_match = bean

    return best_match, best_score

def normalize_text(text: str) -> str:
    """í…ìŠ¤íŠ¸ ì •ê·œí™” (ê³µë°±, íŠ¹ìˆ˜ë¬¸ì ì œê±°)"""
    text = text.lower()
    text = re.sub(r'\s+', '', text)
    text = re.sub(r'[^ê°€-í£a-z0-9]', '', text)
    return text
```

#### 3) í…ìŠ¤íŠ¸ íŒŒì‹± (text_parser.py)

```python
def extract_quantity(text: str) -> Optional[float]:
    """
    ìˆ˜ëŸ‰ ì¶”ì¶œ (kg ë‹¨ìœ„ë¡œ ë³€í™˜)

    ì§€ì› í˜•ì‹:
    - "10kg", "10 kg", "10KG"
    - "10,000g", "10000 g"
    - "10.5kg"
    """
    patterns = [
        r'(\d+(?:,\d{3})*(?:\.\d+)?)\s*kg',  # 10kg, 10,000kg
        r'(\d+(?:,\d{3})*(?:\.\d+)?)\s*g',    # 10000g
    ]

    for pattern in patterns:
        match = re.search(pattern, text, re.IGNORECASE)
        if match:
            quantity = float(match.group(1).replace(',', ''))

            # g â†’ kg ë³€í™˜
            if 'g' in pattern and 'kg' not in pattern:
                quantity = quantity / 1000

            return quantity

    return None

def extract_price(text: str) -> Optional[float]:
    """
    ê°€ê²© ì¶”ì¶œ (ì› ë‹¨ìœ„)

    ì§€ì› í˜•ì‹:
    - "â‚©15,000", "15,000ì›"
    - "15000", "15,000"
    """
    patterns = [
        r'[â‚©ï¿¦]\s*(\d+(?:,\d{3})*)',  # â‚©15,000
        r'(\d+(?:,\d{3})*)\s*ì›',       # 15,000ì›
        r'(\d+(?:,\d{3})*)',            # 15000 (fallback)
    ]

    for pattern in patterns:
        match = re.search(pattern, text)
        if match:
            price = float(match.group(1).replace(',', ''))
            return price

    return None

def extract_date(text: str) -> Optional[datetime.date]:
    """
    ë‚ ì§œ ì¶”ì¶œ (dateparser ì‚¬ìš©)

    ì§€ì› í˜•ì‹:
    - "2025-11-12", "2025/11/12", "2025.11.12"
    - "2025ë…„ 11ì›” 12ì¼"
    - "11/12/2025"
    """
    import dateparser

    parsed_date = dateparser.parse(text, languages=['ko', 'en'])

    if parsed_date:
        return parsed_date.date()

    return None
```

#### 4) ì‹ ë¢°ë„ ê³„ì‚° (ocr_service.py)

```python
def calculate_confidence(parsed_data: Dict, ocr_raw: str) -> float:
    """
    ì¸ì‹ ê²°ê³¼ì˜ ì‹ ë¢°ë„ ê³„ì‚° (0~100)

    ê³„ì‚° ë¡œì§:
    - í•„ìˆ˜ í•„ë“œ ì¡´ì¬ ì—¬ë¶€ (60ì )
    - ì›ë‘ëª… ë§¤ì¹­ ì ìˆ˜ (20ì )
    - OCR í…ìŠ¤íŠ¸ ê¸¸ì´ (10ì )
    - ìˆ«ì í˜•ì‹ ìœ íš¨ì„± (10ì )
    """
    score = 0.0

    # 1. í•„ìˆ˜ í•„ë“œ ì¡´ì¬ (ê° 15ì )
    required_fields = ['bean_name', 'quantity', 'unit_price', 'invoice_date']
    for field in required_fields:
        if parsed_data.get(field):
            score += 15

    # 2. ì›ë‘ëª… ë§¤ì¹­ ì ìˆ˜ (0~20ì )
    bean_match_score = parsed_data.get('bean_match_score', 0)
    score += bean_match_score * 20

    # 3. OCR í…ìŠ¤íŠ¸ ê¸¸ì´ (ìµœì†Œ 100ì ì´ìƒì´ë©´ ë§Œì )
    text_length_score = min(len(ocr_raw) / 100, 1.0) * 10
    score += text_length_score

    # 4. ìˆ«ì í˜•ì‹ ìœ íš¨ì„± (ìˆ˜ëŸ‰, ë‹¨ê°€ê°€ ì–‘ìˆ˜ë©´ ê° 5ì )
    if parsed_data.get('quantity', 0) > 0:
        score += 5
    if parsed_data.get('unit_price', 0) > 0:
        score += 5

    return min(score, 100.0)
```

#### 5) GSC ëª…ì„¸ì„œ ì „ìš© íŒŒì‹± ë¡œì§ (text_parser.py) â­ **ì‹ ê·œ ì¶”ê°€**

```python
def detect_invoice_type(ocr_text: str) -> str:
    """
    ëª…ì„¸ì„œ íƒ€ì… ê°ì§€

    Returns:
        'GSC' | 'HACIELO' | 'UNKNOWN'
    """
    # GSC ëª…ì„¸ì„œ ì‹œê·¸ë‹ˆì²˜
    if 'ê±°ë˜ëª…ì„¸ì„œ' in ocr_text and ('197-04-00506' in ocr_text or 'GSC' in ocr_text):
        return 'GSC'

    # HACIELO ëª…ì„¸ì„œ ì‹œê·¸ë‹ˆì²˜
    if 'HACIELO' in ocr_text or 'ìµœê·¼ 3ê°œì›” ì£¼ë¬¸ë‚´ì—­' in ocr_text:
        return 'HACIELO'

    return 'UNKNOWN'

def parse_gsc_invoice(ocr_text: str) -> Dict:
    """
    GSC ëª…ì„¸ì„œ ì „ìš© íŒŒì‹± ë¡œì§

    í…Œì´ë¸” í˜•ì‹ì„ íŒŒì‹±í•˜ì—¬ ë‹¤ì¤‘ ì›ë‘ ì¶”ì¶œ

    Returns:
        {
            'invoice_date': date,
            'supplier': str,
            'contract_number': str,
            'total_amount': float,
            'total_weight': float,
            'items': [
                {
                    'bean_name': str,
                    'spec': str,          # ê·œê²© (1kg, 5kg, ...)
                    'quantity': int,      # ìˆ˜ëŸ‰ (í¬ì¥ ê°œìˆ˜)
                    'weight': float,      # ì¤‘ëŸ‰ (kg)
                    'unit_price': float,  # ë‹¨ê°€ (ì›/kg)
                    'amount': float       # ê³µê¸‰ê°€ì•¡ (ì›)
                },
                ...
            ]
        }
    """
    result = {
        'supplier': 'GSC GREEN COFFEE',
        'items': []
    }

    # 1. ê³„ì•½ì¼ì ì¶”ì¶œ (í•˜ë‹¨)
    date_pattern = r'ê³„ì•½ì¼ì\s*[:ï¼š]\s*(\d{4})ë…„\s*(\d{1,2})ì›”\s*(\d{1,2})ì¼'
    date_match = re.search(date_pattern, ocr_text)
    if date_match:
        year, month, day = date_match.groups()
        result['invoice_date'] = datetime.date(int(year), int(month), int(day))

    # 2. ê³„ì•½ë²ˆí˜¸ ì¶”ì¶œ
    contract_pattern = r'ê³„ì•½ë²ˆí˜¸\s*[:ï¼š]\s*([A-Z0-9]+)'
    contract_match = re.search(contract_pattern, ocr_text)
    if contract_match:
        result['contract_number'] = contract_match.group(1)

    # 3. ì´ ì¤‘ëŸ‰ ì¶”ì¶œ (í•˜ë‹¨)
    weight_pattern = r'ì´\s*ì¤‘ëŸ‰\s*[:ï¼š]\s*(\d+(?:\.\d+)?)\s*[Kk]g'
    weight_match = re.search(weight_pattern, ocr_text)
    if weight_match:
        result['total_weight'] = float(weight_match.group(1))

    # 4. í•©ê³„ê¸ˆì•¡ ì¶”ì¶œ (í•˜ë‹¨)
    amount_pattern = r'í•©ê³„ê¸ˆì•¡\s*[:ï¼š]\s*([\d,]+)\s*ì›'
    amount_match = re.search(amount_pattern, ocr_text)
    if amount_match:
        result['total_amount'] = float(amount_match.group(1).replace(',', ''))

    # 5. í…Œì´ë¸” íŒŒì‹± (í•µì‹¬ ë¡œì§)
    items = parse_gsc_table(ocr_text)
    result['items'] = items

    return result

def parse_gsc_table(ocr_text: str) -> List[Dict]:
    """
    GSC ëª…ì„¸ì„œ í…Œì´ë¸” íŒŒì‹±

    í…Œì´ë¸” í˜•ì‹:
    NO. | í’ˆëª© | ê·œê²© | ìˆ˜ëŸ‰ | ì¤‘ëŸ‰ | ë‹¨ê°€ | ê³µê¸‰ê°€ì•¡

    ì „ëµ:
    1. í…Œì´ë¸” í—¤ë” ìœ„ì¹˜ ì°¾ê¸° ("NO.", "í’ˆëª©", "ê·œê²©", ...)
    2. í—¤ë” ì•„ë˜ ë¼ì¸ë“¤ì„ ìˆœíšŒ
    3. ê° ë¼ì¸ì—ì„œ 7ê°œ í•„ë“œ ì¶”ì¶œ
    4. ìˆ«ìê°€ ì•„ë‹Œ ë¼ì¸ì€ ê±´ë„ˆë›°ê¸° (ë¹ˆ í–‰)
    """
    items = []

    # í…Œì´ë¸” ì„¹ì…˜ ì¶”ì¶œ (NO.ë¶€í„° í•˜ë‹¨ ì •ë³´ ì „ê¹Œì§€)
    table_start = ocr_text.find('NO.')
    table_end = ocr_text.find('ë²¤ìŠ¬ë¹„')

    if table_start == -1 or table_end == -1:
        return items

    table_text = ocr_text[table_start:table_end]
    lines = table_text.split('\n')

    # í—¤ë” ë¼ì¸ ê±´ë„ˆë›°ê¸° (ì²« 2ì¤„)
    for line in lines[2:]:
        # ë¹ˆ ë¼ì¸ ê±´ë„ˆë›°ê¸°
        if not line.strip():
            continue

        # NO. ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ë¼ì¸ë§Œ ì²˜ë¦¬
        if not re.match(r'^\s*\d+', line):
            continue

        # ë¼ì¸ íŒŒì‹±
        item = parse_gsc_table_row(line, lines)
        if item:
            items.append(item)

    return items

def parse_gsc_table_row(line: str, all_lines: List[str]) -> Optional[Dict]:
    """
    GSC í…Œì´ë¸” í•œ í–‰ íŒŒì‹±

    íŒ¨í„´:
    1  Colombia Supreme Hulls  1kg  30  30  14,500  435,000

    ì£¼ì˜:
    - ì›ë‘ëª…ì´ ê¸¸ì–´ì„œ ì—¬ëŸ¬ ë‹¨ì–´ë¡œ êµ¬ì„± (Brazil NY2 FC 17/18 M-Y TYPE)
    - ìˆ«ìëŠ” ì‰¼í‘œ í¬í•¨ ê°€ëŠ¥ (14,500)
    """
    # ì •ê·œì‹: NO. | ì›ë‘ëª… (ì—¬ëŸ¬ ë‹¨ì–´) | ê·œê²© | ìˆ˜ëŸ‰ | ì¤‘ëŸ‰ | ë‹¨ê°€ | ê³µê¸‰ê°€ì•¡
    pattern = r'''
        ^\s*(\d+)                           # NO.
        \s+(.+?)                            # ì›ë‘ëª… (greedy, ìµœëŒ€í•œ ë§ì´)
        \s+(\d+\s*kg)                       # ê·œê²© (1kg, 5kg, ...)
        \s+(\d+)                            # ìˆ˜ëŸ‰
        \s+(\d+)                            # ì¤‘ëŸ‰
        \s+([\d,]+)                         # ë‹¨ê°€
        \s+([\d,]+)                         # ê³µê¸‰ê°€ì•¡
    '''

    match = re.search(pattern, line, re.VERBOSE)

    if not match:
        return None

    no, bean_name, spec, quantity, weight, unit_price, amount = match.groups()

    # ì›ë‘ëª… ì •ë¦¬ (ì–‘ìª½ ê³µë°± ì œê±°)
    bean_name = bean_name.strip()

    # ìˆ«ì ë³€í™˜
    quantity = int(quantity)
    weight = float(weight)
    unit_price = float(unit_price.replace(',', ''))
    amount = float(amount.replace(',', ''))

    return {
        'no': int(no),
        'bean_name': bean_name,
        'spec': spec.strip(),
        'quantity': quantity,
        'weight': weight,
        'unit_price': unit_price,
        'amount': amount
    }

def extract_gsc_bean_names(table_items: List[Dict]) -> List[str]:
    """
    GSC í…Œì´ë¸”ì—ì„œ ì›ë‘ëª…ë§Œ ì¶”ì¶œ

    ì›ë‘ëª… íŒ¨í„´:
    - Colombia Supreme Hulls
    - Brazil NY2 FC 17/18 M-Y TYPE
    - Ethiopia G1 Guji Uraga Washed
    - Guatemala SHB Antigua
    - Kenya AA FAQ
    - Panama Elida Estates Geisha Natural

    ê³µí†µ íŠ¹ì§•:
    - ì˜ë¬¸ìœ¼ë¡œ ì‹œì‘
    - êµ­ê°€ëª… í¬í•¨ (Colombia, Brazil, Ethiopia, ...)
    - ë“±ê¸‰ í‘œê¸° (G1, G2, AA, SHB, NY2, ...)
    - ê°€ê³µë²• (Washed, Natural, Hulls, ...)
    """
    bean_names = []

    for item in table_items:
        bean_name = item['bean_name']

        # êµ­ê°€ëª… ì¶”ì¶œ (ë§¤ì¹­ìš©)
        countries = {
            'Colombia': 'Co',
            'Brazil': 'Br',
            'Ethiopia': 'Eth',
            'Guatemala': 'Gu',
            'Kenya': 'K',
            'Panama': 'Pa',
            'Costa Rica': 'Cos'
        }

        country_code = None
        for country, code in countries.items():
            if country in bean_name:
                country_code = code
                break

        bean_names.append({
            'name': bean_name,
            'country_code': country_code,
            'weight': item['weight'],
            'unit_price': item['unit_price']
        })

    return bean_names
```

#### 6) í…Œì´ë¸” ì¸ì‹ ê°œì„  (OpenCV) â­ **ì„ íƒ ì‚¬í•­**

```python
def detect_table_structure(image: np.ndarray) -> List[Tuple[int, int, int, int]]:
    """
    OpenCVë¥¼ ì‚¬ìš©í•œ í…Œì´ë¸” êµ¬ì¡° ê°ì§€

    ì „ëµ:
    1. ìˆ˜í‰ì„  ê°ì§€ (HoughLines)
    2. ìˆ˜ì§ì„  ê°ì§€
    3. êµì°¨ì  ê³„ì‚° â†’ ì…€ ì¢Œí‘œ

    Returns:
        [(x1, y1, x2, y2), ...] ê° ì…€ì˜ ë°”ìš´ë”© ë°•ìŠ¤
    """
    # 1. Canny Edge Detection
    edges = cv2.Canny(image, 50, 150, apertureSize=3)

    # 2. HoughLinesë¡œ ì„  ê°ì§€
    lines = cv2.HoughLinesP(edges, 1, np.pi/180, threshold=100,
                            minLineLength=100, maxLineGap=10)

    # 3. ìˆ˜í‰ì„ ê³¼ ìˆ˜ì§ì„  ë¶„ë¦¬
    horizontal_lines = []
    vertical_lines = []

    for line in lines:
        x1, y1, x2, y2 = line[0]

        # ìˆ˜í‰ì„  (ê¸°ìš¸ê¸° ì‘ìŒ)
        if abs(y2 - y1) < 10:
            horizontal_lines.append((x1, y1, x2, y2))

        # ìˆ˜ì§ì„  (ê¸°ìš¸ê¸° í¼)
        if abs(x2 - x1) < 10:
            vertical_lines.append((x1, y1, x2, y2))

    # 4. êµì°¨ì  ê³„ì‚°í•˜ì—¬ ì…€ ì¢Œí‘œ ì¶”ì¶œ
    cells = calculate_cells(horizontal_lines, vertical_lines)

    return cells
```

### ğŸ“ íŒŒì¼ êµ¬ì¡°

```
TheMoon_Project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ ImageInvoiceUpload.py       # â­ ì‹ ê·œ í˜ì´ì§€
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ invoice_service.py          # â­ ì‹ ê·œ (ì…ê³  ì²˜ë¦¬)
â”‚   â”‚   â”œâ”€â”€ ocr_service.py              # â­ ì‹ ê·œ (OCR + íŒŒì‹±)
â”‚   â”‚   â””â”€â”€ learning_service.py         # â­ ì‹ ê·œ (í•™ìŠµ ë°ì´í„°)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ invoice.py                  # â­ ì‹ ê·œ (3ê°œ ëª¨ë¸)
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ image_utils.py              # â­ ì‹ ê·œ (ì´ë¯¸ì§€ ì „ì²˜ë¦¬)
â”‚   â”‚   â””â”€â”€ text_parser.py              # â­ ì‹ ê·œ (í…ìŠ¤íŠ¸ íŒŒì‹±)
â”‚   â”‚
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ test_image_utils.py         # â­ ì‹ ê·œ
â”‚       â”œâ”€â”€ test_text_parser.py         # â­ ì‹ ê·œ
â”‚       â”œâ”€â”€ test_ocr_service.py         # â­ ì‹ ê·œ
â”‚       â”œâ”€â”€ test_invoice_service.py     # â­ ì‹ ê·œ
â”‚       â”œâ”€â”€ test_learning_service.py    # â­ ì‹ ê·œ
â”‚       â””â”€â”€ test_invoice_integration.py # â­ ì‹ ê·œ
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ invoices/                       # â­ ì‹ ê·œ ë””ë ‰í† ë¦¬
â”‚       â”œâ”€â”€ 20251112_143022_ì˜ˆê°€ì²´í”„.jpg
â”‚       â””â”€â”€ temp/                       # ì„ì‹œ íŒŒì¼
â”‚
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ add_invoice_tables.py           # â­ ì‹ ê·œ ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚
â”œâ”€â”€ Documents/
â”‚   â”œâ”€â”€ Architecture/
â”‚   â”‚   â””â”€â”€ INVOICE_OCR_ARCHITECTURE.md # â­ ì‹ ê·œ ë¬¸ì„œ
â”‚   â””â”€â”€ Guides/
â”‚       â””â”€â”€ IMAGE_INVOICE_UPLOAD_GUIDE.md # â­ ì‹ ê·œ ë¬¸ì„œ
â”‚
â””â”€â”€ requirements.txt                     # íŒ¨í‚¤ì§€ ì¶”ê°€
```

---

## 5. Tasks (ì‘ì—… ë¶„í•´)

### ğŸ“‹ Phase êµ¬ì¡° (6ê°œ Phase)

```
Phase 0: í™˜ê²½ ì„¤ì • (1ì‹œê°„)
  â””â”€ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€, Python íŒ¨í‚¤ì§€, ë””ë ‰í† ë¦¬ ìƒì„±

Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ (2ì‹œê°„)
  â””â”€ Invoice, InvoiceItem, InvoiceLearning ëª¨ë¸ + ë§ˆì´ê·¸ë ˆì´ì…˜

Phase 2: ì´ë¯¸ì§€ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹° (4ì‹œê°„)
  â””â”€ ì „ì²˜ë¦¬, OCR, í…ìŠ¤íŠ¸ íŒŒì‹±

Phase 3: ì„œë¹„ìŠ¤ ê³„ì¸µ (4ì‹œê°„)
  â””â”€ invoice_service, ocr_service, learning_service

Phase 4: UI êµ¬í˜„ (4ì‹œê°„)
  â””â”€ ImageInvoiceUpload.py í˜ì´ì§€

Phase 5: í•™ìŠµ ê¸°ëŠ¥ (2ì‹œê°„)
  â””â”€ ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ ì •í™•ë„ í–¥ìƒ

Phase 6: í…ŒìŠ¤íŠ¸ & ë¬¸ì„œí™” (2ì‹œê°„)
  â””â”€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸, ë¬¸ì„œ ì‘ì„±
```

### **Phase 0: í™˜ê²½ ì„¤ì •** (1ì‹œê°„)

#### Task 0-1: ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
sudo apt-get update
sudo apt-get install tesseract-ocr tesseract-ocr-kor
sudo apt-get install poppler-utils
tesseract --version  # ë²„ì „ í™•ì¸
```

#### Task 0-2: Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
./venv/bin/pip install pytesseract==0.3.10
./venv/bin/pip install opencv-python==4.8.1.78
./venv/bin/pip install pdf2image==1.16.3
./venv/bin/pip install python-Levenshtein==0.25.0
./venv/bin/pip install dateparser==1.2.0
```

#### Task 0-3: ë””ë ‰í† ë¦¬ ìƒì„±
```bash
mkdir -p data/invoices
mkdir -p data/invoices/temp
```

**ê²€ì¦ ê¸°ì¤€:**
- âœ… `tesseract --version` ì„±ê³µ
- âœ… `import pytesseract; pytesseract.get_tesseract_version()` ì„±ê³µ
- âœ… `data/invoices/` ë””ë ‰í† ë¦¬ ì¡´ì¬

---

### **Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸** (2ì‹œê°„)

#### Task 1-1: Invoice ëª¨ë¸ ìƒì„±
- **íŒŒì¼**: `app/models/invoice.py`
- **ë‚´ìš©**: Invoice, InvoiceItem, InvoiceLearning í´ë˜ìŠ¤
- **ê´€ê³„**:
  - Invoice 1:N InvoiceItem
  - InvoiceItem 1:N InvoiceLearning
  - InvoiceItem N:1 Bean

#### Task 1-2: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
- **íŒŒì¼**: `migrations/add_invoice_tables.py`
- **ë‚´ìš©**:
  - 3ê°œ í…Œì´ë¸” ìƒì„±
  - ê¸°ì¡´ DB ë°±ì—…
  - Transaction í…Œì´ë¸”ì— invoice_item_id ì»¬ëŸ¼ ì¶”ê°€

#### Task 1-3: database.py ì—…ë°ì´íŠ¸
- `from app.models.invoice import Invoice, InvoiceItem, InvoiceLearning` ì¶”ê°€
- `Base.metadata.create_all()` í˜¸ì¶œ

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì„±ê³µ
- âœ… `SELECT * FROM invoices` ì¿¼ë¦¬ ì„±ê³µ
- âœ… SQLAlchemy ëª¨ë¸ë¡œ CRUD ì‘ë™

---

### **Phase 2: ì´ë¯¸ì§€ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹°** (4ì‹œê°„)

#### Task 2-1: image_utils.py êµ¬í˜„
**í•¨ìˆ˜ ëª©ë¡:**
- `preprocess_image(image: Image) -> Image`
  - ê·¸ë ˆì´ìŠ¤ì¼€ì¼, ë…¸ì´ì¦ˆ ì œê±°, ëŒ€ë¹„ í–¥ìƒ, ì´ì§„í™”
- `rotate_image(image: Image, angle: int) -> Image`
  - íšŒì „ ë³´ì •
- `enhance_contrast(image: Image) -> Image`
  - CLAHE ëŒ€ë¹„ í–¥ìƒ
- `denoise_image(image: Image) -> Image`
  - Gaussian Blur
- `pdf_to_image(pdf_path: str) -> List[Image]`
  - PDF â†’ ì´ë¯¸ì§€ ë³€í™˜ (ì²« í˜ì´ì§€ë§Œ)

#### Task 2-2: text_parser.py êµ¬í˜„
**í•¨ìˆ˜ ëª©ë¡:**
- `extract_bean_name(text: str) -> str`
  - ì›ë‘ëª… ì¶”ì¶œ (ì •ê·œì‹ + íœ´ë¦¬ìŠ¤í‹±)
- `extract_quantity(text: str) -> Optional[float]`
  - ìˆ˜ëŸ‰ ì¶”ì¶œ (kg ë‹¨ìœ„ ë³€í™˜)
- `extract_price(text: str) -> Optional[float]`
  - ê°€ê²© ì¶”ì¶œ (ì› ë‹¨ìœ„)
- `extract_date(text: str) -> Optional[date]`
  - ë‚ ì§œ ì¶”ì¶œ (dateparser ì‚¬ìš©)
- `fuzzy_match_bean(ocr_name: str, beans: List[Bean]) -> Tuple[Bean, float]`
  - ì›ë‘ëª… ìœ ì‚¬ë„ ë§¤ì¹­ (Levenshtein)
- `normalize_text(text: str) -> str`
  - í…ìŠ¤íŠ¸ ì •ê·œí™”

#### Task 2-3: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **íŒŒì¼**: `app/tests/test_image_utils.py` (8ê°œ í…ŒìŠ¤íŠ¸)
- **íŒŒì¼**: `app/tests/test_text_parser.py` (12ê°œ í…ŒìŠ¤íŠ¸)
- **ì»¤ë²„ë¦¬ì§€**: 80%+

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ìƒ˜í”Œ ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì„±ê³µ (ìœ¡ì•ˆ í™•ì¸)
- âœ… "10kg" â†’ 10.0 ë³€í™˜ ì„±ê³µ
- âœ… "ì—í‹°ì˜¤í”¼ì•„ì˜ˆê°€ì²´í”„" â†” "ì—í‹°ì˜¤í”¼ì•„ ì˜ˆê°€ì²´í”„ G1" ë§¤ì¹­ (ìœ ì‚¬ë„ 0.8+)
- âœ… ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

---

### **Phase 3: ì„œë¹„ìŠ¤ ê³„ì¸µ** (4ì‹œê°„)

#### Task 3-1: ocr_service.py êµ¬í˜„
**í´ë˜ìŠ¤**: `OCRService(db: Session)`

**ë©”ì„œë“œ:**
- `extract_text_from_image(image_path: str) -> str`
  - Tesseract OCR ìˆ˜í–‰ (lang='kor+eng')
- `parse_invoice_data(ocr_text: str) -> Dict`
  - OCR í…ìŠ¤íŠ¸ â†’ êµ¬ì¡°í™”ëœ ë°ì´í„°
- `match_bean_to_db(bean_name: str) -> Tuple[Bean, float]`
  - DB ì›ë‘ëª…ê³¼ ë§¤ì¹­ (ìœ ì‚¬ë„ 0.7 ì´ìƒ)
- `calculate_confidence(parsed_data: Dict, ocr_text: str) -> float`
  - ì‹ ë¢°ë„ ê³„ì‚° (0~100)

#### Task 3-2: invoice_service.py êµ¬í˜„
**í´ë˜ìŠ¤**: `InvoiceService(db: Session)`

**ë©”ì„œë“œ:**
- `process_invoice_image(image_file, ocr_service: OCRService) -> Dict`
  - ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
- `save_invoice(invoice_data: Dict, items: List[Dict]) -> Invoice`
  - Invoice + InvoiceItem ì €ì¥
  - ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ (data/invoices/)
- `confirm_invoice(invoice_id: int) -> None`
  - ì…ê³  í™•ì • (Inventory + Transaction ìƒì„±)
- `get_invoice_history(limit: int = 20) -> List[Invoice]`
  - ìµœê·¼ ì²˜ë¦¬ ë‚´ì—­ ì¡°íšŒ

#### Task 3-3: learning_service.py êµ¬í˜„
**í´ë˜ìŠ¤**: `LearningService(db: Session)`

**ë©”ì„œë“œ:**
- `save_correction(invoice_item_id: int, field: str, ocr_value: str, corrected_value: str)`
  - ì‚¬ìš©ì ìˆ˜ì • ë‚´ì—­ ì €ì¥
- `get_learning_data(field: str) -> List[InvoiceLearning]`
  - í•™ìŠµ ë°ì´í„° ì¡°íšŒ
- `suggest_correction(ocr_value: str, field: str) -> Optional[str]`
  - ê³¼ê±° í•™ìŠµ ë°ì´í„° ê¸°ë°˜ ì œì•ˆ

#### Task 3-4: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **íŒŒì¼**: `app/tests/test_ocr_service.py` (10ê°œ í…ŒìŠ¤íŠ¸)
- **íŒŒì¼**: `app/tests/test_invoice_service.py` (8ê°œ í…ŒìŠ¤íŠ¸)
- **íŒŒì¼**: `app/tests/test_learning_service.py` (5ê°œ í…ŒìŠ¤íŠ¸)

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ìƒ˜í”Œ ì´ë¯¸ì§€ â†’ íŒŒì‹±ëœ ë°ì´í„° ì •í™•ë„ 90%+
- âœ… ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

---

### **Phase 4: UI êµ¬í˜„** (4ì‹œê°„)

#### Task 4-1: ImageInvoiceUpload.py í˜ì´ì§€ êµ¬ì¡°
**ë ˆì´ì•„ì›ƒ**: 3ê°œ íƒ­
- **Tab 1: ì´ë¯¸ì§€ ì—…ë¡œë“œ**
  - `st.file_uploader()` (JPG, PNG, PDF)
  - ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° (`st.image`)
  - [ë¶„ì„ ì‹œì‘] ë²„íŠ¼

- **Tab 2: ì¸ì‹ ê²°ê³¼ í™•ì¸**
  - ì‹ ë¢°ë„ í‘œì‹œ (`st.metric`)
  - ë‹¤ì¤‘ ì›ë‘ í•­ëª© (`st.expander`)
  - ê° í•­ëª© ìˆ˜ì • í¼ (`st.form`)
  - [ì…ê³  í™•ì •] ë²„íŠ¼

- **Tab 3: ì²˜ë¦¬ ë‚´ì—­**
  - ìµœê·¼ 20ê±´ í…Œì´ë¸” (`st.dataframe`)
  - ì´ë¯¸ì§€ í´ë¦­ ì‹œ í™•ëŒ€ (`st.image`)

#### Task 4-2: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ ë¡œì§
```python
uploaded_file = st.file_uploader("ê±°ë˜ ëª…ì„¸ì„œ ì—…ë¡œë“œ",
                                 type=['jpg', 'jpeg', 'png', 'pdf'])

if st.button("ë¶„ì„ ì‹œì‘"):
    with st.spinner("AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
        result = st.session_state.invoice_service.process_invoice_image(
            uploaded_file, st.session_state.ocr_service
        )
        st.session_state.invoice_result = result
```

#### Task 4-3: ì¸ì‹ ê²°ê³¼ í™•ì¸ ë° ìˆ˜ì • UI
- ë‹¤ì¤‘ ì›ë‘ í•­ëª© í‘œì‹œ (`st.expander`)
- ê° í•­ëª©ë§ˆë‹¤ ìˆ˜ì • í¼
- ì›ë‘ ì„ íƒ (ë“œë¡­ë‹¤ìš´ + ê²€ìƒ‰)
- ìˆ˜ëŸ‰, ë‹¨ê°€, ë‚ ì§œ, ê³µê¸‰ì—…ì²´ ì…ë ¥

#### Task 4-4: ì…ê³  í™•ì • ë¡œì§
```python
if st.button("ì…ê³  í™•ì •", type="primary"):
    invoice = st.session_state.invoice_service.save_invoice(
        invoice_data=result['invoice'],
        items=result['items']
    )
    st.session_state.invoice_service.confirm_invoice(invoice.id)
    st.success(f"âœ… {len(result['items'])}ê°œ ì›ë‘ ì…ê³  ì™„ë£Œ!")
```

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ
- âœ… ë¶„ì„ ê²°ê³¼ í‘œì‹œ
- âœ… ìˆ˜ì • í›„ ì…ê³  í™•ì • ì„±ê³µ
- âœ… DBì— ë°ì´í„° ì •ìƒ ì €ì¥

---

### **Phase 5: í•™ìŠµ ê¸°ëŠ¥** (2ì‹œê°„)

#### Task 5-1: í•™ìŠµ ë°ì´í„° í™œìš©
```python
def parse_invoice_data_with_learning(self, ocr_text: str) -> Dict:
    """í•™ìŠµ ë°ì´í„°ë¥¼ ì°¸ê³ í•˜ì—¬ íŒŒì‹±"""
    parsed = self.parse_invoice_data(ocr_text)

    # í•™ìŠµ ë°ì´í„° ì œì•ˆ ì ìš©
    for field in ['bean_name', 'quantity', 'unit_price']:
        if parsed.get(field):
            suggestion = self.learning_service.suggest_correction(
                parsed[field], field
            )
            if suggestion:
                parsed[f'{field}_suggested'] = suggestion

    return parsed
```

#### Task 5-2: í•™ìŠµ í†µê³„ í˜ì´ì§€
- **Tab 4: í•™ìŠµ í†µê³„** ì¶”ê°€
  - ì´ í•™ìŠµ ë°ì´í„° ìˆ˜
  - í•„ë“œë³„ ìˆ˜ì • ë¹ˆë„
  - ìì£¼ ìˆ˜ì •ë˜ëŠ” ì›ë‘ëª… Top 5
  - í•™ìŠµ íš¨ê³¼ (ìˆ˜ì • ë¹ˆë„ ê°ì†Œìœ¨)

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ìˆ˜ì • ë‚´ì—­ì´ InvoiceLearning í…Œì´ë¸”ì— ì €ì¥
- âœ… ê°™ì€ ì˜¤ë¥˜ ì¬ë°œìƒ ì‹œ ì œì•ˆ í‘œì‹œ
- âœ… í•™ìŠµ í†µê³„ í˜ì´ì§€ ì •ìƒ ì‘ë™

---

### **Phase 6: í…ŒìŠ¤íŠ¸ & ë¬¸ì„œí™”** (2ì‹œê°„)

#### Task 6-1: í†µí•© í…ŒìŠ¤íŠ¸
- **íŒŒì¼**: `app/tests/test_invoice_integration.py`
- **ì‹œë‚˜ë¦¬ì˜¤**: ìƒ˜í”Œ ì´ë¯¸ì§€ â†’ ë¶„ì„ â†’ ìˆ˜ì • â†’ ì…ê³  â†’ DB ê²€ì¦

#### Task 6-2: ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- ì´ë¯¸ì§€ í¬ê¸°ë³„ ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •
- **ëª©í‘œ**: 10MB ì´ë¯¸ì§€ < 5ì´ˆ

#### Task 6-3: ë¬¸ì„œ ì‘ì„±
- **íŒŒì¼**: `Documents/Guides/IMAGE_INVOICE_UPLOAD_GUIDE.md`
  - ì‚¬ìš©ì ê°€ì´ë“œ (ìŠ¤í¬ë¦°ìƒ· í¬í•¨)
  - ì£¼ì˜ì‚¬í•­, FAQ

- **íŒŒì¼**: `Documents/Architecture/INVOICE_OCR_ARCHITECTURE.md`
  - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
  - ë°ì´í„° íë¦„
  - ì•Œê³ ë¦¬ì¦˜ ì„¤ëª…

#### Task 6-4: README ì—…ë°ì´íŠ¸
- ì‹ ê·œ ê¸°ëŠ¥ ì¶”ê°€
- íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
- **ë²„ì „ ì—…ë°ì´íŠ¸**: 0.30.3 â†’ 0.31.0 (MINOR)

**ê²€ì¦ ê¸°ì¤€:**
- âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (ë‹¨ìœ„ + í†µí•©)
- âœ… ì»¤ë²„ë¦¬ì§€ 80%+
- âœ… ë¬¸ì„œ ì™„ì„±

---

## 6. ì˜ˆìƒ ì¼ì •

### ğŸ“Š ì´ ì˜ˆìƒ ì‹œê°„: 19ì‹œê°„ (ì•½ 2.5ì¼)

```
Day 1 (8ì‹œê°„):
  â”œâ”€ Phase 0: í™˜ê²½ ì„¤ì • (1ì‹œê°„)
  â”œâ”€ Phase 1: DB ëª¨ë¸ (2ì‹œê°„)
  â”œâ”€ Phase 2: ì´ë¯¸ì§€ ì²˜ë¦¬ (4ì‹œê°„)
  â””â”€ íœ´ì‹ (1ì‹œê°„)

Day 2 (8ì‹œê°„):
  â”œâ”€ Phase 3: ì„œë¹„ìŠ¤ ê³„ì¸µ (4ì‹œê°„)
  â”œâ”€ Phase 4: UI êµ¬í˜„ (4ì‹œê°„)
  â””â”€ íœ´ì‹

Day 3 (3ì‹œê°„):
  â”œâ”€ Phase 5: í•™ìŠµ ê¸°ëŠ¥ (2ì‹œê°„)
  â””â”€ Phase 6: í…ŒìŠ¤íŠ¸ & ë¬¸ì„œí™” (2ì‹œê°„) - ì¼ë¶€ ì´ì›” ê°€ëŠ¥
```

### ğŸ“… ë§ˆì¼ìŠ¤í†¤

| Phase | ì™„ë£Œ ê¸°ì¤€ | ì˜ˆìƒ ì‹œê°„ |
|-------|----------|----------|
| Phase 0 | íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ | 1ì‹œê°„ |
| Phase 1 | DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ | 2ì‹œê°„ |
| Phase 2 | ìœ í‹¸ë¦¬í‹° + í…ŒìŠ¤íŠ¸ ì™„ë£Œ | 4ì‹œê°„ |
| Phase 3 | ì„œë¹„ìŠ¤ + í…ŒìŠ¤íŠ¸ ì™„ë£Œ | 4ì‹œê°„ |
| Phase 4 | UI ì •ìƒ ì‘ë™ | 4ì‹œê°„ |
| Phase 5 | í•™ìŠµ ê¸°ëŠ¥ ì‘ë™ | 2ì‹œê°„ |
| Phase 6 | ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ | 2ì‹œê°„ |

---

## 7. ì„±ê³µ ê¸°ì¤€

### ğŸ“Œ ê¸°ëŠ¥ì  ëª©í‘œ

```
âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ì…ê³  ì™„ë£Œê¹Œì§€ < 1ë¶„
âœ… GSC ëª…ì„¸ì„œ OCR ì¸ì‹ë¥  85%+ (í‘œì¤€í™”ëœ ì–‘ì‹)
âœ… HACIELO ëª…ì„¸ì„œ OCR ì¸ì‹ë¥  70%+ (ë¹„í‘œì¤€ ì–‘ì‹)
âœ… ì›ë‘ëª… ë§¤ì¹­ ì •í™•ë„ 90%+ (Levenshtein Distance)
âœ… ë‹¤ì¤‘ ì›ë‘ ì§€ì› (ìµœëŒ€ 10ê°œ)
âœ… í…Œì´ë¸” íŒŒì‹± ì •í™•ë„ 95%+ (GSC ëª…ì„¸ì„œ)
âœ… ì‹ ë¢°ë„ ë‚®ì„ ì‹œ ìˆ˜ë™ ë³´ì • UI ì œê³µ
```

### ğŸ“Œ ë¹„ê¸°ëŠ¥ì  ëª©í‘œ

```
âœ… ì²˜ë¦¬ ì‹œê°„ < 5ì´ˆ (10MB ì´ë¯¸ì§€)
âœ… ì‹ ë¢°ë„ í‘œì‹œë¡œ ì‚¬ìš©ì ì‹ ë¢° í™•ë³´
âœ… ìˆ˜ë™ ë³´ì • UI ì§ê´€ì 
âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (ì»¤ë²„ë¦¬ì§€ 80%+)
âœ… ì˜¤ë¥˜ ë°œìƒ ì‹œ ìš°ì•„í•œ Fallback
```

### ğŸ“Œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œ

```
âœ… ì…ë ¥ ì‹œê°„ 80% ì ˆê° (5ë¶„ â†’ 1ë¶„)
âœ… ì…ë ¥ ì˜¤ë¥˜ 50% ê°ì†Œ (í•™ìŠµ ê¸°ëŠ¥)
âœ… ì‚¬ìš©ì ë§Œì¡±ë„ í–¥ìƒ
âœ… ê°ì‚¬/ì„¸ë¬´ ëŒ€ì‘ (ì´ë¯¸ì§€ ì˜êµ¬ ë³´ê´€)
```

### ğŸ“Œ KPI (í•µì‹¬ ì„±ê³¼ ì§€í‘œ)

| ì§€í‘œ | ëª©í‘œ (GSC) | ëª©í‘œ (HACIELO) | ì¸¡ì • ë°©ë²• |
|-----|-----------|---------------|----------|
| OCR ì¸ì‹ë¥  | 85%+ | 70%+ | ìƒ˜í”Œ ì´ë¯¸ì§€ 10ê°œ í…ŒìŠ¤íŠ¸ |
| í…Œì´ë¸” íŒŒì‹± ì •í™•ë„ | 95%+ | 80%+ | í•„ë“œë³„ ì •í™•ë„ ì¸¡ì • |
| ì›ë‘ëª… ë§¤ì¹­ ì •í™•ë„ | 90%+ | 85%+ | Levenshtein ìœ ì‚¬ë„ ì¸¡ì • |
| ì²˜ë¦¬ ì‹œê°„ | < 5ì´ˆ | < 8ì´ˆ | 10MB ì´ë¯¸ì§€ ê¸°ì¤€ |
| ë‹¤ì¤‘ ì›ë‘ ì²˜ë¦¬ | 1~6ê°œ | 1~3ê°œ | ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ |
| ì‚¬ìš©ì ìˆ˜ì • ë¹ˆë„ | < 20% | < 40% | í•™ìŠµ ê¸°ëŠ¥ìœ¼ë¡œ ê°ì†Œ |
| í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ | 80%+ | 70%+ | pytest-cov |

**GSC ëª…ì„¸ì„œ ê¸°ì¤€**: í‘œì¤€í™”ëœ ì–‘ì‹ìœ¼ë¡œ ë†’ì€ ì •í™•ë„ ê¸°ëŒ€
**HACIELO ëª…ì„¸ì„œ ê¸°ì¤€**: ë¹„í‘œì¤€ ì–‘ì‹ìœ¼ë¡œ ë‚®ì€ ì •í™•ë„ í—ˆìš©

---

## 8. ë¦¬ìŠ¤í¬ ê´€ë¦¬

### âš ï¸ ë¦¬ìŠ¤í¬ ëª©ë¡

#### ë¦¬ìŠ¤í¬ 1: Tesseract ì¸ì‹ë¥  ë‚®ìŒ (70% ë¯¸ë§Œ)
**í™•ë¥ **: ì¤‘ (50%)
**ì˜í–¥**: ë†’ìŒ

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ê°•í™” (íšŒì „, ëŒ€ë¹„, ë…¸ì´ì¦ˆ)
- **2ì°¨**: ìƒ˜í”Œ ì´ë¯¸ì§€ ë¶„ì„ í›„ ë§ì¶¤ íŒŒì‹± ë¡œì§
- **3ì°¨**: Claude Vision APIë¡œ ì „í™˜ ê³ ë ¤ (ìœ ë£Œ)

---

#### ë¦¬ìŠ¤í¬ 2: ê±°ë˜ ëª…ì„¸ì„œ í˜•ì‹ ë‹¤ì–‘ì„±
**í™•ë¥ **: ë†’ìŒ (80%)
**ì˜í–¥**: ì¤‘

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: ìƒ˜í”Œ ì´ë¯¸ì§€ ë¶„ì„ í›„ ë§ì¶¤ íŒŒì‹± ë¡œì§
- **2ì°¨**: í•™ìŠµ ê¸°ëŠ¥ìœ¼ë¡œ ì ì§„ì  ê°œì„ 
- **3ì°¨**: ì—…ì²´ë³„ í…œí”Œë¦¿ ë“±ë¡ ê¸°ëŠ¥ (í–¥í›„)

---

#### ë¦¬ìŠ¤í¬ 3: êµ¬í˜„ ë²”ìœ„ ë„ˆë¬´ í¼ (í•™ìŠµ ê¸°ëŠ¥ ë“±)
**í™•ë¥ **: ì¤‘ (40%)
**ì˜í–¥**: ì¤‘

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: MVP ìš°ì„  (Phase 0~4), í•™ìŠµ ê¸°ëŠ¥ì€ Phase 5ë¡œ ë¶„ë¦¬
- **2ì°¨**: í•„ìˆ˜ ê¸°ëŠ¥ë§Œ ë¨¼ì € êµ¬í˜„
- **3ì°¨**: í•™ìŠµ ê¸°ëŠ¥ì€ ë‹¤ìŒ ë²„ì „ìœ¼ë¡œ ì´ì›”

---

#### ë¦¬ìŠ¤í¬ 4: ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ê¶Œí•œ ì—†ìŒ
**í™•ë¥ **: ë‚®ìŒ (20%)
**ì˜í–¥**: ë†’ìŒ (ì°¨ë‹¨)

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: Docker í™˜ê²½ êµ¬ì„±
- **2ì°¨**: ì‚¬ìš©ìì—ê²Œ sudo ê¶Œí•œ ìš”ì²­
- **3ì°¨**: Claude Vision APIë¡œ ì „í™˜ (ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ë¶ˆí•„ìš”)

---

#### ë¦¬ìŠ¤í¬ 5: ì„±ëŠ¥ ì´ìŠˆ (ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€)
**í™•ë¥ **: ì¤‘ (50%)
**ì˜í–¥**: ì¤‘

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (ìµœëŒ€ 3000x3000px)
- **2ì°¨**: ë¹„ë™ê¸° ì²˜ë¦¬ (ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…)
- **3ì°¨**: ì—…ë¡œë“œ í¬ê¸° ì œí•œ (5MB)

---

#### ë¦¬ìŠ¤í¬ 6: ê°œì¸ì •ë³´ ë³´í˜¸ ì´ìŠˆ
**í™•ë¥ **: ë‚®ìŒ (20%)
**ì˜í–¥**: ë†’ìŒ

**ëŒ€ì‘ ë°©ì•ˆ:**
- **1ì°¨**: íŒŒì¼ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬ (data/invoices/ í´ë”)
- **2ì°¨**: ê°œì¸ì •ë³´ ìë™ ë§ˆìŠ¤í‚¹ (ì „í™”ë²ˆí˜¸, ì£¼ì†Œ ë“±)
- **3ì°¨**: ë³´ê´€ ì •ì±… ëª…ì‹œ (ì‚¬ìš©ì ë™ì˜)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

### ì˜µì…˜ A: ì¦‰ì‹œ êµ¬í˜„ ì‹œì‘
```
1. Phase 0ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ êµ¬í˜„
2. ê° Phase ì™„ë£Œ í›„ ì»¤ë°‹ + ë¬¸ì„œ ì—…ë°ì´íŠ¸
3. ì•½ 2.5ì¼ ì†Œìš”
```

### ì˜µì…˜ B: ìƒ˜í”Œ ì´ë¯¸ì§€ ë¶„ì„ í›„ êµ¬í˜„ (ê¶Œì¥ â­)
```
1. ì‹¤ì œ ê±°ë˜ ëª…ì„¸ì„œ ìƒ˜í”Œ ì´ë¯¸ì§€ ì œê³µ
2. ëª…ì„¸ì„œ í˜•ì‹ ë¶„ì„ (ë ˆì´ì•„ì›ƒ, í•„ë“œ ìœ„ì¹˜)
3. ë§ì¶¤í˜• íŒŒì‹± ë¡œì§ ê°œì„ 
4. êµ¬í˜„ ì‹œì‘ (ì •í™•ë„ í–¥ìƒ ê¸°ëŒ€)
```

### ì˜µì…˜ C: MVP ìš°ì„  êµ¬í˜„
```
1. Phase 5 (í•™ìŠµ ê¸°ëŠ¥) ì œì™¸
2. í•µì‹¬ ê¸°ëŠ¥ë§Œ ë¨¼ì € êµ¬í˜„ (Phase 0~4)
3. ì•½ 2ì¼ ì†Œìš”
4. ì´í›„ í•™ìŠµ ê¸°ëŠ¥ ì¶”ê°€ (v0.32.0)
```

---

## ğŸ“¸ ìƒ˜í”Œ ì´ë¯¸ì§€ ì œê³µ ìš”ì²­

ì‹¤ì œ ì‚¬ìš©í•˜ì‹œëŠ” **ê±°ë˜ ëª…ì„¸ì„œ ìƒ˜í”Œ ì´ë¯¸ì§€**ë¥¼ ì œê³µí•´ì£¼ì‹œë©´
ë” ì •í™•í•œ ë§ì¶¤í˜• êµ¬í˜„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!

**ì œê³µ ë°©ë²•:**
1. ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ (ê°œì¸ì •ë³´ëŠ” ê°€ë ¤ì£¼ì„¸ìš”)
2. ë˜ëŠ” ëª…ì„¸ì„œ í˜•ì‹ ì„¤ëª…:
   ```
   - ì—…ì²´ëª…: ìƒë‹¨ ì¢Œì¸¡/ìš°ì¸¡?
   - ì›ë‘ëª…: í‘œ í˜•ì‹? ë‹¨ìˆœ ë‚˜ì—´?
   - ìˆ˜ëŸ‰/ë‹¨ê°€: ê°™ì€ í–‰? ë‹¤ë¥¸ í–‰?
   - ë‚ ì§œ: ìƒë‹¨? í•˜ë‹¨?
   ```

---

## ğŸ“ ë²„ì „ ê´€ë¦¬

**ëª©í‘œ ë²„ì „**: v0.31.0 (MINOR)

**ë³€ê²½ ì‚¬í•­:**
- ì‹ ê·œ ê¸°ëŠ¥: ê±°ë˜ ëª…ì„¸ì„œ ì´ë¯¸ì§€ ìë™ ì…ê³ 
- ì‹ ê·œ í…Œì´ë¸”: Invoice, InvoiceItem, InvoiceLearning
- ì‹ ê·œ í˜ì´ì§€: ImageInvoiceUpload.py
- ì‹ ê·œ ì„œë¹„ìŠ¤: invoice_service, ocr_service, learning_service
- ì‹ ê·œ ìœ í‹¸ë¦¬í‹°: image_utils, text_parser

**í˜¸í™˜ì„±:**
- í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ âœ…
- ê¸°ì¡´ ê¸°ëŠ¥ ì˜í–¥ ì—†ìŒ âœ…

---

## ğŸ“š ì°¸ê³  ìë£Œ

**Tesseract OCR:**
- ê³µì‹ ë¬¸ì„œ: https://github.com/tesseract-ocr/tesseract
- pytesseract: https://pypi.org/project/pytesseract/

**OpenCV:**
- ê³µì‹ ë¬¸ì„œ: https://docs.opencv.org/
- ì´ë¯¸ì§€ ì „ì²˜ë¦¬: https://docs.opencv.org/4.x/d7/d4d/tutorial_py_thresholding.html

**Levenshtein Distance:**
- python-Levenshtein: https://pypi.org/project/python-Levenshtein/

**Streamlit:**
- íŒŒì¼ ì—…ë¡œë“œ: https://docs.streamlit.io/library/api-reference/widgets/st.file_uploader

---

**ë¬¸ì„œ ë²„ì „**: 1.0
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-11-12
**ì‘ì„±ì**: Claude (AI Assistant)
