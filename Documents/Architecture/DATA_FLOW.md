# ğŸ”„ TheMoon ë°ì´í„° íë¦„ë„ (Data Flow Diagram)

> **ì‘ì„±ì¼**: 2025-12-07
> **ë²„ì „**: 0.0.6
> **ì‘ì„±ì**: AI Assistant

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì „ì²´ ë°ì´í„° íë¦„](#ì „ì²´-ë°ì´í„°-íë¦„)
3. [ê¸°ëŠ¥ë³„ ë°ì´í„° íë¦„](#ê¸°ëŠ¥ë³„-ë°ì´í„°-íë¦„)
4. [ë°ì´í„° ë³€í™˜ ê·œì¹™](#ë°ì´í„°-ë³€í™˜-ê·œì¹™)
5. [ì—ëŸ¬ ì²˜ë¦¬ íë¦„](#ì—ëŸ¬-ì²˜ë¦¬-íë¦„)

---

## ê°œìš”

TheMoon ì‹œìŠ¤í…œì˜ ë°ì´í„°ëŠ” **í”„ë¡ íŠ¸ì—”ë“œ â†’ ë°±ì—”ë“œ â†’ ë°ì´í„°ë² ì´ìŠ¤** 3ê³„ì¸µì„ ê±°ì¹˜ë©°,
ê° ê³„ì¸µì—ì„œ ê²€ì¦, ë³€í™˜, ì˜ì†í™” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

### ë°ì´í„° íë¦„ ì›ì¹™

1. **ë‹¨ë°©í–¥ íë¦„**: ì‚¬ìš©ì ì•¡ì…˜ â†’ ìƒíƒœ ì—…ë°ì´íŠ¸ â†’ UI ì¬ë Œë”ë§
2. **ì„œë²„ ì‹ ë¢°**: í”„ë¡ íŠ¸ì—”ë“œëŠ” ë°±ì—”ë“œ ì‘ë‹µì„ ì‹ ë¢°í•˜ê³  ê·¸ëŒ€ë¡œ í‘œì‹œ
3. **ë‚™ê´€ì  ì—…ë°ì´íŠ¸**: SWRì˜ Optimistic Update í™œìš©
4. **ì—ëŸ¬ ì „íŒŒ**: ê° ê³„ì¸µì—ì„œ ë°œìƒí•œ ì—ëŸ¬ëŠ” ìƒìœ„ ê³„ì¸µìœ¼ë¡œ ì „íŒŒ

---

## ì „ì²´ ë°ì´í„° íë¦„

### ì½ê¸° (Read) íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì‚¬ìš©ì ìš”ì²­                                                â”‚
â”‚     - í˜ì´ì§€ ì ‘ì† ë˜ëŠ” ë°ì´í„° ìƒˆë¡œê³ ì¹¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Frontend (Next.js)                                        â”‚
â”‚     useBeans() í›… ì‹¤í–‰ (SWR)                                  â”‚
â”‚     â”œâ”€ Cache Hit? â†’ ì¦‰ì‹œ ë°˜í™˜                                 â”‚
â”‚     â””â”€ Cache Miss â†’ API í˜¸ì¶œ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. HTTP Request                                              â”‚
â”‚     GET /api/v1/beans?skip=0&limit=100                       â”‚
â”‚     Headers: {                                                â”‚
â”‚       Content-Type: application/json                          â”‚
â”‚       Accept: application/json                                â”‚
â”‚     }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Backend (FastAPI)                                         â”‚
â”‚     API Endpoint: GET /api/v1/beans/                          â”‚
â”‚     â”œâ”€ Query Parameter ê²€ì¦ (Pydantic)                        â”‚
â”‚     â”œâ”€ Service í˜¸ì¶œ: BeanService.get_beans()                  â”‚
â”‚     â””â”€ Response Schema ë³€í™˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Service Layer                                             â”‚
â”‚     BeanService.get_beans(skip, limit, search)                â”‚
â”‚     â”œâ”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬                                      â”‚
â”‚     â”œâ”€ Repository í˜¸ì¶œ (ORM ì¿¼ë¦¬)                             â”‚
â”‚     â””â”€ ê²°ê³¼ ë°˜í™˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Database (PostgreSQL)                                     â”‚
â”‚     SQL Query:                                                â”‚
â”‚     SELECT * FROM beans                                       â”‚
â”‚     WHERE name LIKE '%search%'                                â”‚
â”‚     ORDER BY created_at DESC                                  â”‚
â”‚     LIMIT 100 OFFSET 0;                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Response ì—­ìˆœ ì „íŒŒ                                         â”‚
â”‚     DB â†’ Service â†’ API â†’ Frontend                             â”‚
â”‚     ê° ê³„ì¸µì—ì„œ ë°ì´í„° ë³€í™˜:                                   â”‚
â”‚     - DB Row â†’ SQLAlchemy Model                               â”‚
â”‚     - Model â†’ Pydantic Schema                                 â”‚
â”‚     - JSON â†’ TypeScript Interface                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. Frontend State ì—…ë°ì´íŠ¸                                    â”‚
â”‚     SWR Cache ê°±ì‹  â†’ React State ì—…ë°ì´íŠ¸ â†’ UI ì¬ë Œë”ë§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì“°ê¸° (Write) íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì‚¬ìš©ì ì•¡ì…˜                                                â”‚
â”‚     - í¼ ì œì¶œ (ìƒë‘ ë“±ë¡, ë¡œìŠ¤íŒ… ì‹¤í–‰ ë“±)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Frontend Validation                                       â”‚
â”‚     í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦:                                        â”‚
â”‚     - í•„ìˆ˜ í•„ë“œ í™•ì¸                                           â”‚
â”‚     - íƒ€ì… ê²€ì¦                                                â”‚
â”‚     - ë²”ìœ„ ê²€ì¦ (ì˜ˆ: ìˆ˜ëŸ‰ > 0)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. HTTP Request                                              â”‚
â”‚     POST /api/v1/beans/                                       â”‚
â”‚     Body: {                                                   â”‚
â”‚       name: "ì˜ˆê°€ì²´í”„",                                       â”‚
â”‚       type: "GREEN_BEAN",                                     â”‚
â”‚       origin: "Ethiopia",                                     â”‚
â”‚       quantity_kg: 20,                                        â”‚
â”‚       avg_price: 12000                                        â”‚
â”‚     }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Backend Validation                                        â”‚
â”‚     Pydantic Schema ê²€ì¦:                                     â”‚
â”‚     - íƒ€ì… ê°•ì œ ë³€í™˜                                           â”‚
â”‚     - í•„ë“œ ê²€ì¦ (max_length, min_value ë“±)                    â”‚
â”‚     - ì»¤ìŠ¤í…€ ê²€ì¦ ë¡œì§                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Service Layer (Transaction)                               â”‚
â”‚     BeanService.create_bean(data)                             â”‚
â”‚     â”œâ”€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§:                                          â”‚
â”‚     â”‚  - SKU ìë™ ìƒì„±                                         â”‚
â”‚     â”‚  - ì´ˆê¸° ì¬ê³  ë¡œê·¸ ìƒì„±                                   â”‚
â”‚     â”œâ”€ DB íŠ¸ëœì­ì…˜ ì‹œì‘                                       â”‚
â”‚     â”œâ”€ Bean ìƒì„±                                               â”‚
â”‚     â”œâ”€ InventoryLog ìƒì„±                                       â”‚
â”‚     â””â”€ íŠ¸ëœì­ì…˜ ì»¤ë°‹                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Database Transaction                                      â”‚
â”‚     BEGIN;                                                    â”‚
â”‚       INSERT INTO beans (...) VALUES (...);                   â”‚
â”‚       INSERT INTO inventory_logs (...) VALUES (...);          â”‚
â”‚     COMMIT;                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Response + Cache Invalidation                             â”‚
â”‚     - ìƒì„±ëœ Bean ë°˜í™˜                                         â”‚
â”‚     - SWR Cache ë¬´íš¨í™” (mutate)                               â”‚
â”‚     - UI ìë™ ì¬ë Œë”ë§                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê¸°ëŠ¥ë³„ ë°ì´í„° íë¦„

### 1. ìƒë‘ ë“±ë¡ (Bean Registration)

```
[ì‚¬ìš©ì]
   â†“ 1. í¼ ì…ë ¥
[BeanForm ì»´í¬ë„ŒíŠ¸]
   â†“ 2. í´ë¼ì´ì–¸íŠ¸ ê²€ì¦
[createBean() í•¨ìˆ˜]
   â†“ 3. POST /api/v1/beans/
[FastAPI Endpoint]
   â†“ 4. Pydantic ê²€ì¦
[BeanService]
   â†“ 5. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
   â”œâ”€ Bean ê°ì²´ ìƒì„±
   â””â”€ InventoryLog ìƒì„± (PURCHASE)
[SQLAlchemy]
   â†“ 6. INSERT INTO beans
   â†“ 7. INSERT INTO inventory_logs
[PostgreSQL]
   â†“ 8. ë°ì´í„° ì €ì¥
[Response]
   â†“ 9. ìƒì„±ëœ Bean ë°˜í™˜
[SWR]
   â†“ 10. Cache ë¬´íš¨í™”
[UI]
   â””â”€ 11. ëª©ë¡ ìë™ ê°±ì‹ 
```

### 2. Single Origin ë¡œìŠ¤íŒ… (Roasting)

```
[ì‚¬ìš©ì]
   â†“ 1. ë¡œìŠ¤íŒ… í¼ ì œì¶œ
      - green_bean_id: 1
      - input_weight: 20kg
      - output_weight: 17kg
      - roast_profile: MEDIUM
[RoastingService]
   â†“ 2. ì†ì‹¤ë¥  ê³„ì‚°
      loss_rate = (20 - 17) / 20 = 15%
   â†“ 3. ì›ê°€ ê³„ì‚°
      roasted_price = green_price / (1 - loss_rate)
                    = 12,000 / 0.85 = 14,118ì›/kg
   â†“ 4. íŠ¸ëœì­ì…˜ ì‹œì‘
   â”œâ”€ 5a. ìƒë‘ ì¬ê³  ê°ì†Œ (-20kg)
   â”‚   â””â”€ InventoryLog ìƒì„± (ROASTING_INPUT, -20kg)
   â”œâ”€ 5b. ì›ë‘ ê°ì²´ ìƒì„± (17kg, 14,118ì›/kg)
   â”‚   â””â”€ Bean í…Œì´ë¸” INSERT
   â””â”€ 5c. ì›ë‘ ì¬ê³  ì¦ê°€ (+17kg)
       â””â”€ InventoryLog ìƒì„± (ROASTING_OUTPUT, +17kg)
   â†“ 6. íŠ¸ëœì­ì…˜ ì»¤ë°‹
[Response]
   â””â”€ 7. ë¡œìŠ¤íŒ… ê²°ê³¼ ë°˜í™˜
      {
        "success": true,
        "roasted_bean": { ... },
        "loss_rate_percent": 15,
        "production_cost": 14118
      }
```

### 3. ë¸”ë Œë“œ ë ˆì‹œí”¼ ìƒì„± (Blend Creation)

```
[ì‚¬ìš©ì]
   â†“ 1. ë¸”ë Œë“œ í¼ ì œì¶œ
      name: "Full Moon"
      recipe: [
        {bean_id: 6, ratio: 0.4},
        {bean_id: 9, ratio: 0.4},
        {bean_id: 2, ratio: 0.1},
        {bean_id: 5, ratio: 0.1}
      ]
[BlendService]
   â†“ 2. ê²€ì¦
      - ë¹„ìœ¨ í•©ê³„ = 1.0 í™•ì¸
      - ëª¨ë“  bean_id ì¡´ì¬ í™•ì¸
   â†“ 3. Blend ìƒì„±
      - recipeë¥¼ JSONìœ¼ë¡œ ì €ì¥
      - ëª©í‘œ ë¡œìŠ¤íŒ… ë ˆë²¨ ì €ì¥
[Database]
   â†“ 4. INSERT INTO blends
[Response]
   â””â”€ 5. ìƒì„±ëœ ë¸”ë Œë“œ ë°˜í™˜
```

### 4. ë¸”ë Œë“œ ë¡œìŠ¤íŒ… (Blend Roasting)

```
[ì‚¬ìš©ì]
   â†“ 1. ë¸”ë Œë“œ ë¡œìŠ¤íŒ… ìš”ì²­
      - blend_id: 1 (Full Moon)
      - output_weight: 10kg
[RoastingService]
   â†“ 2. ë¸”ë Œë“œ ë ˆì‹œí”¼ ì¡°íšŒ
      recipe = Blend.get(1).recipe
   â†“ 3. ê° ì›ë‘ í•„ìš”ëŸ‰ ê³„ì‚°
      ë§ˆì‚¬ì´: 10kg Ã— 0.4 = 4kg
      ì•ˆí‹°êµ¬ì•„: 10kg Ã— 0.4 = 4kg
      ëª¨ëª¨ë¼: 10kg Ã— 0.1 = 1kg
      ì‹œë‹¤ëª¨: 10kg Ã— 0.1 = 1kg
   â†“ 4. íŠ¸ëœì­ì…˜ ì‹œì‘
   â”œâ”€ 5a. ê° ì›ë‘ ì¬ê³  ì°¨ê°
   â”‚   â”œâ”€ ë§ˆì‚¬ì´ -4kg (InventoryLog)
   â”‚   â”œâ”€ ì•ˆí‹°êµ¬ì•„ -4kg (InventoryLog)
   â”‚   â”œâ”€ ëª¨ëª¨ë¼ -1kg (InventoryLog)
   â”‚   â””â”€ ì‹œë‹¤ëª¨ -1kg (InventoryLog)
   â”œâ”€ 5b. ë¸”ë Œë“œ ì›ë‘ ìƒì„±
   â”‚   â””â”€ Bean í…Œì´ë¸” INSERT (type=BLEND_BEAN)
   â””â”€ 5c. ë¸”ë Œë“œ ì›ë‘ ì¬ê³  ì¦ê°€ (+10kg)
       â””â”€ InventoryLog ìƒì„± (ROASTING_OUTPUT, +10kg)
   â†“ 6. ê°€ì¤‘ í‰ê·  ì›ê°€ ê³„ì‚°
      cost = (ë§ˆì‚¬ì´ ë‹¨ê°€ Ã— 0.4) + (ì•ˆí‹°êµ¬ì•„ Ã— 0.4) +
             (ëª¨ëª¨ë¼ Ã— 0.1) + (ì‹œë‹¤ëª¨ Ã— 0.1)
   â†“ 7. íŠ¸ëœì­ì…˜ ì»¤ë°‹
[Response]
   â””â”€ 8. ë¸”ë Œë“œ ë¡œìŠ¤íŒ… ê²°ê³¼ ë°˜í™˜
```

### 5. ì¬ê³  ì¡°íšŒ ë° ê²€ìƒ‰ (Inventory Search)

```
[ì‚¬ìš©ì]
   â†“ 1. ê²€ìƒ‰ì–´ ì…ë ¥ ("ì˜ˆê°€")
[Frontend]
   â†“ 2. Debounce (300ms ëŒ€ê¸°)
[SWR]
   â†“ 3. GET /api/v1/beans?search=ì˜ˆê°€&limit=12
[BeanService]
   â†“ 4. LIKE ì¿¼ë¦¬ ì‹¤í–‰
      SELECT * FROM beans
      WHERE name LIKE '%ì˜ˆê°€%'
         OR origin LIKE '%ì˜ˆê°€%'
         OR variety LIKE '%ì˜ˆê°€%'
[PostgreSQL]
   â†“ 5. Full-text Search
[Response]
   â””â”€ 6. í•„í„°ë§ëœ ê²°ê³¼ ë°˜í™˜
      [
        {id: 1, name: "ì˜ˆê°€ì²´í”„", ...},
        ...
      ]
```

---

## ë°ì´í„° ë³€í™˜ ê·œì¹™

### Frontend â†’ Backend

| Frontend (TypeScript) | HTTP Body (JSON) | Backend (Python) |
|----------------------|------------------|------------------|
| `name: string` | `"name": "ì˜ˆê°€ì²´í”„"` | `name: str` |
| `type: BeanType` | `"type": "GREEN_BEAN"` | `type: BeanType (Enum)` |
| `quantity_kg: number` | `"quantity_kg": 20` | `quantity_kg: float` |
| `avg_price: number` | `"avg_price": 12000` | `avg_price: float` |
| `created_at: string` | `"created_at": "2025-12-07T12:00:00Z"` | `created_at: datetime` |

### Backend â†’ Database

| Python (SQLAlchemy) | PostgreSQL (Column Type) | ì˜ˆì‹œ ê°’ |
|---------------------|--------------------------|---------|
| `id: int` | `INTEGER PRIMARY KEY` | `1` |
| `name: str` | `VARCHAR(255)` | `"ì˜ˆê°€ì²´í”„"` |
| `type: BeanType` | `VARCHAR(20)` | `"GREEN_BEAN"` |
| `quantity_kg: float` | `NUMERIC(10, 3)` | `20.000` |
| `avg_price: float` | `NUMERIC(10, 2)` | `12000.00` |
| `created_at: datetime` | `TIMESTAMP WITH TIME ZONE` | `2025-12-07 12:00:00+00` |
| `recipe: List[dict]` | `JSONB` | `[{"bean_id": 1, "ratio": 0.4}]` |

### Database â†’ Frontend

```python
# 1. PostgreSQL Row
Row(id=1, name='ì˜ˆê°€ì²´í”„', quantity_kg=Decimal('20.000'))

# 2. SQLAlchemy Model
bean = Bean(id=1, name='ì˜ˆê°€ì²´í”„', quantity_kg=20.0)

# 3. Pydantic Schema
bean_response = BeanResponse(
    id=1,
    name='ì˜ˆê°€ì²´í”„',
    quantity_kg=20.0,
    created_at=datetime(2025, 12, 7, 12, 0, 0)
)

# 4. JSON Response
{
  "id": 1,
  "name": "ì˜ˆê°€ì²´í”„",
  "quantity_kg": 20.0,
  "created_at": "2025-12-07T12:00:00Z"
}

# 5. TypeScript Interface
interface Bean {
  id: number
  name: string
  quantity_kg: number
  created_at: string
}
```

---

## ì—ëŸ¬ ì²˜ë¦¬ íë¦„

### ê²€ì¦ ì—ëŸ¬ (Validation Error)

```
[Frontend]
   â†“ 1. í¼ ì œì¶œ (ì˜ëª»ëœ ë°ì´í„°)
      quantity_kg: -10 (ìŒìˆ˜)
[Backend - Pydantic]
   â†“ 2. ê²€ì¦ ì‹¤íŒ¨
   â””â”€ 422 Unprocessable Entity
      {
        "detail": [
          {
            "loc": ["body", "quantity_kg"],
            "msg": "ensure this value is greater than 0",
            "type": "value_error.number.not_gt"
          }
        ]
      }
[Frontend - Error Handling]
   â””â”€ 3. ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
      "ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤"
```

### ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì—ëŸ¬

```
[Frontend]
   â†“ 1. ë¡œìŠ¤íŒ… ìš”ì²­ (ì¬ê³  ë¶€ì¡±)
      green_bean_id: 1
      input_weight: 100kg (í˜„ì¬ ì¬ê³ : 20kg)
[Backend - RoastingService]
   â†“ 2. ì¬ê³  í™•ì¸
   â””â”€ raise HTTPException(
        status_code=400,
        detail="ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. (í•„ìš”: 100kg, í˜„ì¬: 20kg)"
      )
[Frontend]
   â””â”€ 3. ErrorState ì»´í¬ë„ŒíŠ¸ í‘œì‹œ
      + "ë‹¤ì‹œ ì‹œë„" ë²„íŠ¼
```

### ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬

```
[Frontend]
   â†“ 1. API í˜¸ì¶œ
[Network]
   â†“ 2. ì—°ê²° ì‹¤íŒ¨
   â””â”€ Network Error / Timeout
[SWR - Error Retry]
   â†“ 3. ìë™ ì¬ì‹œë„ (ìµœëŒ€ 5íšŒ)
      ì§€ìˆ˜ ë°±ì˜¤í”„: 5ì´ˆ â†’ 10ì´ˆ â†’ 20ì´ˆ â†’ 40ì´ˆ â†’ 60ì´ˆ
[Frontend]
   â””â”€ 4. ì¬ì‹œë„ ì‹¤íŒ¨ ì‹œ
      ErrorState ì»´í¬ë„ŒíŠ¸ í‘œì‹œ
      "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”"
```

---

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

**â† ìƒìœ„**: [Documents README](../README.md) | [í”„ë¡œì íŠ¸ ë£¨íŠ¸](../../README.md)

**ì•„í‚¤í…ì²˜ ë¬¸ì„œ**:
- [ì‹œìŠ¤í…œ ê°œìš”](SYSTEM_OVERVIEW.md) - ì „ì²´ ì‹œìŠ¤í…œ ê°œìš” ë° í•µì‹¬ ê¸°ëŠ¥
- [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](DATABASE_SCHEMA.md) - í…Œì´ë¸” êµ¬ì¡° ë° ê´€ê³„ë„
- [API ëª…ì„¸](API_SPECIFICATION.md) â­ - ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸ ë¬¸ì„œ
- [ê¸°ìˆ  ìŠ¤íƒ](TECHNOLOGY_STACK.md) â­ - ì‚¬ìš© ê¸°ìˆ  ìƒì„¸ ì„¤ëª…
- [ë°°í¬ ì•„í‚¤í…ì²˜](DEPLOYMENT_ARCHITECTURE.md) â­ - ë°°í¬ í™˜ê²½ ìƒì„¸ êµ¬ì¡°

**ê°œë°œ ê°€ì´ë“œ**:
- [ê°œë°œ ê°€ì´ë“œ](DEVELOPMENT_GUIDE.md) - 5ë‹¨ê³„ ê°œë°œ í”„ë¡œì„¸ìŠ¤
- [ë¬¸ì œ í•´ê²°](TROUBLESHOOTING.md) - 16ê°€ì§€ ì˜¤ë¥˜ & í•´ê²°ë²•

---

**ì‘ì„±**: AI Assistant
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-08
**ë²„ì „**: 0.0.6
